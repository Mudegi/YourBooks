generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id                      String                   @id @default(cuid())
  name                    String
  slug                    String                   @unique
  legalName               String?
  taxIdNumber             String?
  tradingLicense          String?
  baseCurrency            String                   @default("USD")
  fiscalYearStart         Int                      @default(1)
  homeCountry             String                   @default("US")
  package                 PackageTier              @default(ADVANCED)
  compliancePack          String                   @default("DEFAULT")
  address                 String?
  phone                   String?
  email                   String?
  logo                    String?
  isActive                Boolean                  @default(true)
  onboardingCompleted     Boolean                  @default(false)
  industry                String?
  businessModel           String                   @default("GENERAL")
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  activities              Activity[]
  approvalRequests        ApprovalRequest[]
  approvalWorkflows       ApprovalWorkflow[]
  assemblyTransactions    AssemblyTransaction[]
  assets                  Asset[]
  assetCategories         AssetCategory[]
  attributeSets           AttributeSet[]
  auditLogs               AuditLog[]
  bankAccounts            BankAccount[]
  bankFeeds               BankFeed[]
  bankTransactions        BankTransaction[]
  benefits                Benefit[]
  billOfMaterials         BillOfMaterial[]
  branches                Branch[]
  capas                   CAPA[]
  capaTasks               CapaTask[]
  certificatesOfAnalysis  CertificateOfAnalysis[]
  chartOfAccounts         ChartOfAccount[]
  companies               Company[]
  contacts                Contact[]
  costRevaluations        CostRevaluation[]
  costVariances           CostVariance[]
  creditNotes             CreditNote[]
  customers               Customer[]
  cycleCounts             CycleCount[]
  dashboards              Dashboard[]
  dataCubes               DataCube[]
  debitNotes              DebitNote[]
  demandForecasts         DemandForecast[]
  departments             Department[]
  discounts               Discount[]
  documents               Document[]
  documentSequences       DocumentSequence[]
  efrisExcisableList      EFRISExcisableList[]
  eInvoiceConfig          EInvoiceConfig?
  employees               Employee[]
  eventLogs               EventLog[]
  fiscalPeriods           FiscalPeriod[]
  integrations            Integration[]
  inventoryLots           InventoryLot[]
  inventorySerials        InventorySerial[]
  inventoryValuations     InventoryValuation[]
  warehouses              InventoryWarehouse[]
  itemMasters             ItemMaster[]
  jobTitles               JobTitle[]
  landedCosts             LandedCost[]
  leaveTypes              LeaveType[]
  localizationConfig      LocalizationConfig?
  maintenancePlans        MaintenancePlan[]
  maintenanceWorkOrders   MaintenanceWorkOrder[]
  manufacturingLaborCosts ManufacturingLaborCost[]
  manufacturingOverheads  ManufacturingOverhead[]
  nonConformanceReports   NonConformanceReport[]
  opportunities           Opportunity[]
  users                   OrganizationUser[]
  paymentEvents           PaymentEvent[]
  payrollRuns             PayrollRun[]
  positions               Position[]
  priceLists              PriceList[]
  products                Product[]
  productPlannings        ProductPlanning[]
  projects                Project[]
  promotions              Promotion[]
  qualityHolds            QualityHold[]
  qualityInspections      QualityInspection[]
  recurringExecutions     RecurringExecution[]
  recurringTemplates      RecurringTemplate[]
  reorderPolicies         ReorderPolicy[]
  reports                 Report[]
  reportSchedules         ReportSchedule[]
  reviewCycles            ReviewCycle[]
  routings                Routing[]
  rlsRules                RowLevelSecurityRule[]
  ssoConfig               SSOConfig?
  safetyStocks            SafetyStock[]
  serviceSLAs             ServiceSLA[]
  serviceTechnicians      ServiceTechnician[]
  serviceWorkOrders       ServiceWorkOrder[]
  serviceCatalogs         ServiceCatalog[]
  serviceActivities       ServiceActivity[]
  serviceOfferings        ServiceOffering[]
  serviceDeliveries       ServiceDelivery[]
  serviceBookings         ServiceBooking[]
  serviceActivityEntries  ServiceActivityEntry[]
  serviceTimeEntries      ServiceTimeEntry[]
  serviceResources        ServiceResource[]
  spareParts              SparePart[]
  standardCosts           StandardCost[]
  stockReservations       StockReservation[]
  taxConfigs              TaxConfiguration[]
  taxExemptions           TaxExemption[]
  taxJurisdictions        TaxJurisdiction[]
  taxRates                TaxRate[]
  taxReturns              TaxReturn[]
  taxRules                TaxRule[]
  transactions            Transaction[]
  transferOrders          TransferOrder[]
  vendors                 Vendor[]
  whtRules                WHTRule[]
  webhookEndpoints        WebhookEndpoint[]
  workCenters             WorkCenter[]
  workOrders              WorkOrder[]
  roles                   Role[]
  invites                 OrganizationInvite[]
  organizationUserRoles   OrganizationUserRole[]

  @@index([slug])
  @@index([homeCountry])
  @@index([compliancePack])
  unitsOfMeasure      UnitOfMeasure[]
}

model UnitOfMeasure {
  id              String        @id @default(cuid())
  organizationId  String
  code            String
  name            String
  abbreviation    String
  category        String?       // e.g., "length", "weight", "volume", "quantity"
  displayOrder    Int           @default(0)
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  products        Product[]

  @@unique([organizationId, code])
  @@index([organizationId])
}

model Branch {
  id                   String                @id @default(cuid())
  organizationId       String
  code                 String
  name                 String
  type                 BranchType            @default(OFFICE)
  address              String?
  city                 String?
  state                String?
  country              String?
  postalCode           String?
  phone                String?
  email                String?
  managerId            String?
  isHeadquarters       Boolean               @default(false)
  isActive             Boolean               @default(true)
  openingDate          DateTime?
  closingDate          DateTime?
  taxIdNumber          String?
  currency             String                @default("USD")
  timezone             String                @default("UTC")
  metadata             Json?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  assemblyTransactions AssemblyTransaction[]
  assets               Asset[]
  bankAccounts         BankAccount[]
  bills                Bill[]
  organization         Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  creditNotes          CreditNote[]
  customers            Customer[]
  debitNotes           DebitNote[]
  warehouses           InventoryWarehouse[]
  invoices             Invoice[]
  products             Product[]
  recurringTemplates   RecurringTemplate[]
  transactions         Transaction[]
  vendors              Vendor[]
  workOrders           WorkOrder[]
  documentSequences    DocumentSequence[]

  @@unique([organizationId, code])
  @@index([organizationId])
  @@index([isActive])
}

model DocumentSequence {
  id             String           @id @default(cuid())
  organizationId String
  branchId       String?
  documentType   DocumentType
  prefix         String           @default("")
  currentNumber  Int              @default(0)
  year           Int?
  month          Int?
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  branch         Branch?          @relation(fields: [branchId], references: [id])
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, branchId, documentType, year, month])
  @@index([organizationId])
  @@index([branchId])
}

model Integration {
  id             String            @id @default(cuid())
  organizationId String
  name           String
  type           IntegrationType
  provider       String
  status         IntegrationStatus @default(INACTIVE)
  apiKey         String?
  apiSecret      String?
  webhookUrl     String?
  webhookSecret  String?
  config         Json?
  lastSyncAt     DateTime?
  syncFrequency  String?
  errorCount     Int               @default(0)
  lastError      String?
  isActive       Boolean           @default(true)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  eventLogs      EventLog[]
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  syncLogs       IntegrationLog[]
  webhooks       Webhook[]

  @@unique([organizationId, provider])
  @@index([organizationId])
  @@index([type, status])
}

model Webhook {
  id              String       @id @default(cuid())
  integrationId   String
  eventType       String
  url             String
  secret          String?
  isActive        Boolean      @default(true)
  retryCount      Int          @default(0)
  maxRetries      Int          @default(3)
  timeoutSeconds  Int          @default(30)
  lastTriggeredAt DateTime?
  lastSuccess     DateTime?
  lastFailure     DateTime?
  failureReason   String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  integration     Integration  @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  logs            WebhookLog[]

  @@index([integrationId])
  @@index([eventType])
}

model WebhookLog {
  id             String   @id @default(cuid())
  webhookId      String
  eventType      String
  payload        Json
  responseStatus Int?
  responseBody   String?
  success        Boolean
  errorMessage   String?
  executionTime  Int?
  attemptNumber  Int      @default(1)
  createdAt      DateTime @default(now())
  webhook        Webhook  @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([createdAt])
}

model IntegrationLog {
  id               String      @id @default(cuid())
  integrationId    String
  action           String
  status           String
  recordsProcessed Int         @default(0)
  recordsFailed    Int         @default(0)
  errorMessage     String?
  details          Json?
  startedAt        DateTime
  completedAt      DateTime?
  duration         Int?
  createdAt        DateTime    @default(now())
  integration      Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)

  @@index([integrationId])
  @@index([createdAt])
}

model ApiKey {
  id             String    @id @default(cuid())
  organizationId String
  name           String
  key            String    @unique
  prefix         String
  permissions    String[]
  rateLimit      Int       @default(1000)
  expiresAt      DateTime?
  lastUsedAt     DateTime?
  isActive       Boolean   @default(true)
  createdBy      String
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([organizationId])
  @@index([key])
  @@index([isActive, expiresAt])
}

model User {
  id                         String                  @id @default(cuid())
  email                      String                  @unique
  passwordHash               String
  firstName                  String
  lastName                   String
  phone                      String?
  avatar                     String?
  isActive                   Boolean                 @default(true)
  emailVerified              Boolean                 @default(false)
  lastLoginAt                DateTime?
  createdAt                  DateTime                @default(now())
  updatedAt                  DateTime                @updatedAt
  activities                 Activity[]
  approvalActions            ApprovalAction[]        @relation("ApprovalActions")
  delegatedApprovals         ApprovalAction[]        @relation("DelegatedApprovals")
  requestedApprovals         ApprovalRequest[]       @relation("RequestedApprovals")
  auditLogs                  AuditLog[]
  assignedCAPAs              CAPA[]                  @relation("CAPAAssignedTo")
  closedCAPAs                CAPA[]                  @relation("CAPAClosedBy")
  verifiedCAPAs              CAPA[]                  @relation("CAPAVerifiedBy")
  assignedCapaTasks          CapaTask[]              @relation("CapaTaskAssignedTo")
  completedCapaTasks         CapaTask[]              @relation("CapaTaskCompletedBy")
  issuedCOAs                 CertificateOfAnalysis[]
  approvedRevaluations       CostRevaluation[]
  cycleCounts                CycleCount[]
  createdDashboards          Dashboard[]
  documents                  Document[]
  employee                   Employee?
  expenseApprovalsGiven      ExpenseClaim[]          @relation("ExpenseApprover")
  expensePaymentsGiven       ExpenseClaim[]          @relation("ExpensePayer")
  approvedItemMasters        ItemMaster[]            @relation("ApprovedItemMasters")
  createdItemMasters         ItemMaster[]            @relation("CreatedItemMasters")
  leaveApprovalsGiven        LeaveRequest[]
  mfaSettings                MFASettings?
  masterDataChanges          MasterDataVersion[]
  assignedNCRs               NonConformanceReport[]  @relation("NCRAssignedTo")
  closedNCRs                 NonConformanceReport[]  @relation("NCRClosedBy")
  detectedNCRs               NonConformanceReport[]  @relation("NCRDetectedBy")
  organizations              OrganizationUser[]
  projectsManaged            Project[]
  projectTasks               ProjectTask[]
  qualityHoldsCreated        QualityHold[]          @relation("QualityHoldCreatedBy")
  qualityHoldsReleased       QualityHold[]          @relation("QualityHoldReleasedBy")
  qualityInspections         QualityInspection[]
  createdRecurringExecutions RecurringExecution[]
  createdRecurringTemplates  RecurringTemplate[]
  createdReports             Report[]
  timeEntryApprovals         TimeEntry[]
  createdTransactions        Transaction[]           @relation("TransactionCreator")
  sentInvites                OrganizationInvite[]
  serviceTimeEntries         ServiceTimeEntry[]

  @@index([email])
}

model OrganizationUser {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  role           UserRole     @default(VIEWER)
  permissions    String[]
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  roles          OrganizationUserRole[]

  @@unique([organizationId, userId])
  @@index([organizationId])
  @@index([userId])
}

// Named role per organization (e.g., "Senior Accountant", "External Auditor")
model Role {
  id               String                @id @default(cuid())
  organizationId   String
  name             String
  description      String?
  isSystem         Boolean               @default(false)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  organization     Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  permissions      RolePermission[]
  members          OrganizationUserRole[]
  invites          OrganizationInvite[]

  @@unique([organizationId, name])
  @@index([organizationId])
}

// Role-to-permission mapping using section + action matrix
model RolePermission {
  id        String            @id @default(cuid())
  roleId    String
  section   PermissionSection
  action    PermissionAction
  createdAt DateTime          @default(now())
  role      Role              @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, section, action])
  @@index([roleId, section])
}

// Many-to-many mapping between organization users and roles
model OrganizationUserRole {
  id              String           @id @default(cuid())
  organizationId  String
  orgUserId       String
  roleId          String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  organization    Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  orgUser         OrganizationUser @relation(fields: [orgUserId], references: [id], onDelete: Cascade)
  role            Role             @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([orgUserId, roleId])
  @@index([organizationId])
  @@index([orgUserId])
}

// Invitation to join an organization with an optional assigned role
model OrganizationInvite {
  id              String       @id @default(cuid())
  organizationId  String
  email           String
  roleId          String?
  token           String       @unique
  status          InviteStatus @default(PENDING)
  expiresAt       DateTime?
  invitedById     String
  acceptedAt      DateTime?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  role            Role?        @relation(fields: [roleId], references: [id])
  invitedBy       User         @relation(fields: [invitedById], references: [id])

  @@index([organizationId])
  @@index([email])
  @@index([status])
}

model ChartOfAccount {
  id                          String           @id @default(cuid())
  organizationId              String
  code                        String
  name                        String
  accountType                 AccountType
  accountSubType              String?
  parentId                    String?
  currency                    String           @default("USD")
  description                 String?
  isActive                    Boolean          @default(true)
  isSystem                    Boolean          @default(false)
  allowManualJournal          Boolean          @default(true)
  requiresDimension           Boolean          @default(false)
  isBankAccount               Boolean          @default(false)
  balance                     Decimal          @default(0) @db.Decimal(19, 4)
  foreignBalance              Decimal?         @db.Decimal(19, 4)
  level                       Int              @default(0)
  hasChildren                 Boolean          @default(false)
  fullPath                    String?
  tags                        String[]
  metadata                    Json?
  createdAt                   DateTime         @default(now())
  updatedAt                   DateTime         @updatedAt
  assetCategoriesAsset        AssetCategory[]  @relation("AssetAccount")
  assetCategoriesDepreciation AssetCategory[]  @relation("DepreciationAccount")
  assetCategoriesExpense      AssetCategory[]  @relation("ExpenseAccount")
  budgets                     Budget[]
  organization                Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent                      ChartOfAccount?  @relation("AccountHierarchy", fields: [parentId], references: [id])
  children                    ChartOfAccount[] @relation("AccountHierarchy")
  creditNoteItems             CreditNoteItem[]
  debitNoteItems              DebitNoteItem[]
  ledgerEntries               LedgerEntry[]
  billItems                   BillItem[]
  taxJurisdictions            TaxJurisdiction[]

  @@unique([organizationId, code])
  @@index([organizationId, accountType])
  @@index([parentId])
  @@index([currency])
  @@index([isActive])
}

model Transaction {
  id                  String               @id @default(cuid())
  organizationId      String
  branchId            String?
  transactionNumber   String
  transactionDate     DateTime
  transactionType     TransactionType
  referenceType       String?
  referenceId         String?
  description         String
  notes               String?
  attachments         String[]
  status              TransactionStatus    @default(DRAFT)
  isReconciled        Boolean              @default(false)
  createdById         String
  approvedById        String?
  approvedAt          DateTime?
  taxCategory         String?
  taxAmount           Decimal?             @db.Decimal(19, 4)
  taxReturnId         String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  costRevaluation     CostRevaluation?
  costVariances       CostVariance[]
  creditNotes         CreditNote[]
  debitNotes          DebitNote[]
  expenseClaim        ExpenseClaim?
  ledgerEntries       LedgerEntry[]
  payrollRun          PayrollRun?
  recurringExecutions RecurringExecution[]
  bills               Bill[]
  branch              Branch?              @relation(fields: [branchId], references: [id])
  createdBy           User                 @relation("TransactionCreator", fields: [createdById], references: [id])
  organization        Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, transactionNumber])
  @@index([organizationId, transactionDate])
  @@index([organizationId, transactionType])
  @@index([branchId])
  @@index([referenceType, referenceId])
  @@index([taxCategory])
  @@index([taxReturnId])
}

model LedgerEntry {
  id            String         @id @default(cuid())
  transactionId String
  accountId     String
  entryType     EntryType
  amount        Decimal        @db.Decimal(19, 4)
  currency      String         @default("USD")
  exchangeRate  Decimal        @default(1) @db.Decimal(12, 6)
  amountInBase  Decimal        @db.Decimal(19, 4)
  description   String?
  reconciled    Boolean        @default(false)
  reconciledAt  DateTime?
  createdAt     DateTime       @default(now())
  account       ChartOfAccount @relation(fields: [accountId], references: [id])
  transaction   Transaction    @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@index([transactionId])
  @@index([accountId])
  @@index([entryType])
}

model Customer {
  id                       String                 @id @default(cuid())
  organizationId           String
  customerNumber           String
  companyName              String?
  firstName                String
  lastName                 String
  email                    String?
  phone                    String?
  website                  String?
  taxIdNumber              String?
  paymentTerms             Int                    @default(30)
  creditLimit              Decimal?               @db.Decimal(19, 4)
  billingAddress           Json?
  shippingAddress          Json?
  notes                    String?
  isActive                 Boolean                @default(true)
  region                   String?
  taxCategory              String?
  taxExempt                Boolean         @default(false) // New: Tax exemption status
  taxExemptionReason       String?         // New: Reason for tax exemption
  defaultRevenueAccountId  String?
  createdAt                DateTime               @default(now())
  updatedAt                DateTime               @updatedAt
  branchId                 String?
  creditNotes           CreditNote[]
  Branch                Branch?                @relation(fields: [branchId], references: [id])
  organization          Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  debitNotes            DebitNote[]
  invoices              Invoice[]
  nonConformanceReports NonConformanceReport[]
  payments              Payment[]
  projects              Project[]
  serviceWorkOrders     ServiceWorkOrder[]
  serviceDeliveries     ServiceDelivery[]
  serviceBookings       ServiceBooking[]

  @@unique([organizationId, customerNumber])
  @@index([organizationId])
  @@index([email])
}

model Invoice {
  id                  String                  @id @default(cuid())
  organizationId      String
  customerId          String
  invoiceNumber       String
  invoiceDate         DateTime
  dueDate             DateTime
  currency            String                  @default("USD")
  exchangeRate        Decimal                 @default(1) @db.Decimal(12, 6)
  subtotal            Decimal                 @db.Decimal(19, 4)
  taxAmount           Decimal                 @default(0) @db.Decimal(19, 4)
  discountAmount      Decimal                 @default(0) @db.Decimal(19, 4)
  total               Decimal                 @db.Decimal(19, 4)
  amountPaid          Decimal                 @default(0) @db.Decimal(19, 4)
  amountDue           Decimal                 @db.Decimal(19, 4)
  status              InvoiceStatus           @default(DRAFT)
  notes               String?
  terms               String?
  attachments         String[]
  transactionId       String?
  efrisFDN            String?
  efrisQRCode         String?
  whtApplicable       Boolean                 @default(false)
  whtAmount           Decimal                 @default(0) @db.Decimal(19, 4)
  whtRate             Decimal                 @default(0) @db.Decimal(5, 2)
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  branchId            String?
  creditNotes         CreditNote[]
  creditApplications  CreditNoteApplication[]
  debitNotes          DebitNote[]
  Branch              Branch?                 @relation(fields: [branchId], references: [id])
  customer            Customer                @relation(fields: [customerId], references: [id])
  items               InvoiceItem[]
  payments            PaymentAllocation[]
  recurringExecutions RecurringExecution[]
  serviceWorkOrders   ServiceWorkOrder[]

  @@unique([organizationId, invoiceNumber])
  @@index([organizationId, status])
  @@index([customerId])
  @@index([efrisFDN])
}

model InvoiceItem {
  id            String           @id @default(cuid())
  invoiceId     String
  productId     String?
  serviceId     String?
  description   String
  quantity      Decimal          @db.Decimal(12, 4)
  unitPrice     Decimal          @db.Decimal(19, 4)
  discount      Decimal          @default(0) @db.Decimal(19, 4)
  taxRate       Decimal          @default(0) @db.Decimal(5, 2)
  taxAmount     Decimal          @default(0) @db.Decimal(19, 4)
  total         Decimal          @db.Decimal(19, 4)
  sortOrder     Int              @default(0)
  taxRateId     String?
  taxCategory   String?
  invoice       Invoice          @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product       Product?         @relation(fields: [productId], references: [id])
  service       ServiceCatalog?  @relation(fields: [serviceId], references: [id])
  taxRateConfig TaxRate?         @relation(fields: [taxRateId], references: [id])
  taxLines      InvoiceTaxLine[]

  @@index([invoiceId])
  @@index([productId])
  @@index([serviceId])
  @@index([taxRateId])
}

model InvoiceTaxLine {
  id               String           @id @default(cuid())
  invoiceItemId    String
  taxRuleId        String?
  jurisdictionId   String?
  taxType          String
  rate             Decimal          @db.Decimal(5, 2)
  baseAmount       Decimal          @db.Decimal(19, 4)
  taxAmount        Decimal          @db.Decimal(19, 4)
  isCompound       Boolean          @default(false)
  compoundSequence Int              @default(1)
  isWithholding    Boolean          @default(false)
  createdAt        DateTime         @default(now())
  invoiceItem      InvoiceItem      @relation(fields: [invoiceItemId], references: [id], onDelete: Cascade)
  jurisdiction     TaxJurisdiction? @relation(fields: [jurisdictionId], references: [id])
  taxRule          TaxRule?         @relation(fields: [taxRuleId], references: [id])

  @@index([invoiceItemId])
  @@index([taxRuleId])
  @@index([jurisdictionId])
  @@index([isWithholding])
}

model Vendor {
  id                    String                 @id @default(cuid())
  organizationId        String
  vendorNumber          String
  companyName           String
  contactName           String?
  email                 String
  phone                 String?
  website               String?
  taxIdNumber           String?
  paymentTerms          Int                    @default(30)
  bankAccount           Json?
  billingAddress        Json?
  notes                 String?
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  branchId              String?
  bills                 Bill[]
  nonConformanceReports NonConformanceReport[]
  payments              Payment[]
  productPlannings      ProductPlanning[]
  purchaseOrders        PurchaseOrder[]
  Branch                Branch?                @relation(fields: [branchId], references: [id])
  organization          Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  whtTransactions       WHTTransaction[]

  @@unique([organizationId, vendorNumber])
  @@index([organizationId])
}

model PurchaseOrder {
  id             String              @id @default(cuid())
  organizationId String
  vendorId       String
  poNumber       String
  poDate         DateTime
  expectedDate   DateTime?
  currency       String              @default("USD")
  subtotal       Decimal             @db.Decimal(19, 4)
  taxAmount      Decimal             @default(0) @db.Decimal(19, 4)
  total          Decimal             @db.Decimal(19, 4)
  status         POStatus            @default(DRAFT)
  notes          String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  bills          Bill[]
  vendor         Vendor              @relation(fields: [vendorId], references: [id])
  items          PurchaseOrderItem[]

  @@unique([organizationId, poNumber])
  @@index([organizationId, status])
}

model PurchaseOrderItem {
  id              String        @id @default(cuid())
  purchaseOrderId String
  productId       String?
  description     String
  quantity        Decimal       @db.Decimal(12, 4)
  receivedQty     Decimal       @default(0) @db.Decimal(12, 4)
  unitPrice       Decimal       @db.Decimal(19, 4)
  taxRate         Decimal       @default(0) @db.Decimal(5, 2)
  total           Decimal       @db.Decimal(19, 4)
  sortOrder       Int           @default(0)
  product         Product?      @relation(fields: [productId], references: [id])
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@index([purchaseOrderId])
}

model Bill {
  id                  String               @id @default(cuid())
  organizationId      String
  vendorId            String
  purchaseOrderId     String?
  billNumber          String
  vendorInvoiceNo     String?
  billDate            DateTime
  dueDate             DateTime
  currency            String               @default("USD")
  exchangeRate        Decimal              @default(1) @db.Decimal(12, 6)
  subtotal            Decimal              @db.Decimal(19, 4)
  taxAmount           Decimal              @default(0) @db.Decimal(19, 4)
  total               Decimal              @db.Decimal(19, 4)
  amountPaid          Decimal              @default(0) @db.Decimal(19, 4)
  amountDue           Decimal              @db.Decimal(19, 4)
  status              BillStatus           @default(DRAFT)
  notes               String?
  attachments         String[]
  transactionId       String?
  transaction         Transaction?       @relation(fields: [transactionId], references: [id])
  whtApplicable       Boolean              @default(false)
  whtAmount           Decimal              @default(0) @db.Decimal(19, 4)
  whtRate             Decimal              @default(0) @db.Decimal(5, 2)
  whtCertificateNo    String?
  efrisReceiptNo      String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  branchId            String?
  Branch              Branch?              @relation(fields: [branchId], references: [id])
  purchaseOrder       PurchaseOrder?       @relation(fields: [purchaseOrderId], references: [id])
  vendor              Vendor               @relation(fields: [vendorId], references: [id])
  items               BillItem[]
  payments            PaymentAllocation[]
  recurringExecutions RecurringExecution[]
  whtTransactions     WHTTransaction[]

  @@unique([organizationId, billNumber])
  @@index([organizationId, status])
  @@index([vendorId])
  @@index([efrisReceiptNo])
}

model BillItem {
  id            String   @id @default(cuid())
  billId        String
  productId     String?
  serviceId     String?
  accountId     String?
  description   String
  quantity      Decimal  @db.Decimal(12, 4)
  unitPrice     Decimal  @db.Decimal(19, 4)
  taxRate       Decimal  @default(0) @db.Decimal(5, 2)
  taxAmount     Decimal  @default(0) @db.Decimal(19, 4)
  total         Decimal  @db.Decimal(19, 4)
  sortOrder     Int      @default(0)
  taxRateId     String?
  taxCategory   String?
  claimInputTax Boolean  @default(true)
  bill          Bill     @relation(fields: [billId], references: [id], onDelete: Cascade)
  product       Product? @relation(fields: [productId], references: [id])
  service       ServiceCatalog?  @relation(fields: [serviceId], references: [id])
  account       ChartOfAccount? @relation(fields: [accountId], references: [id])
  taxRateConfig TaxRate? @relation(fields: [taxRateId], references: [id])

  @@index([billId])
  @@index([serviceId])
  @@index([taxRateId])
  @@index([accountId])
}

model Payment {
  id                  String               @id @default(cuid())
  organizationId      String
  paymentNumber       String
  paymentDate         DateTime
  paymentType         PaymentType
  amount              Decimal              @db.Decimal(19, 4)
  currency            String               @default("USD")
  exchangeRate        Decimal              @default(1) @db.Decimal(12, 6)
  paymentMethod       PaymentMethod
  referenceNumber     String?
  bankAccountId       String?
  customerId          String?
  vendorId            String?
  notes               String?
  attachments         String[]
  transactionId       String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  bankAccount         BankAccount?         @relation(fields: [bankAccountId], references: [id])
  customer            Customer?            @relation(fields: [customerId], references: [id])
  vendor              Vendor?              @relation(fields: [vendorId], references: [id])
  allocations         PaymentAllocation[]
  paymentEvents       PaymentEvent[]
  recurringExecutions RecurringExecution[]
  debitNotes          DebitNote[]          @relation("DebitNotePayments")

  @@unique([organizationId, paymentNumber])
  @@index([organizationId, paymentDate])
  @@index([customerId])
  @@index([vendorId])
}

model PaymentEvent {
  id             String       @id @default(cuid())
  organizationId String
  provider       String
  eventType      String?
  status         String?
  reference      String?
  externalId     String?
  payload        Json
  rawPayload     String?
  paymentId      String?
  createdAt      DateTime     @default(now())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  payment        Payment?     @relation(fields: [paymentId], references: [id])

  @@index([organizationId, provider, reference])
}

model PaymentAllocation {
  id        String   @id @default(cuid())
  paymentId String
  invoiceId String?
  billId    String?
  amount    Decimal  @db.Decimal(19, 4)
  createdAt DateTime @default(now())
  bill      Bill?    @relation(fields: [billId], references: [id])
  invoice   Invoice? @relation(fields: [invoiceId], references: [id])
  payment   Payment  @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@index([paymentId])
  @@index([invoiceId])
  @@index([billId])
}

model BankAccount {
  id              String               @id @default(cuid())
  organizationId  String
  accountName     String
  accountNumber   String
  bankName        String
  currency        String               @default("USD")
  accountType     BankAccountType
  openingBalance  Decimal              @default(0) @db.Decimal(19, 4)
  currentBalance  Decimal              @default(0) @db.Decimal(19, 4)
  glAccountId     String?
  isActive        Boolean              @default(true)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  branchId        String?
  Branch          Branch?              @relation(fields: [branchId], references: [id])
  organization    Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  bankFeeds       BankFeed[]
  reconciliations BankReconciliation[]
  payments        Payment[]

  @@index([organizationId])
}

model BankReconciliation {
  id               String               @id @default(cuid())
  bankAccountId    String
  statementDate    DateTime
  statementBalance Decimal              @db.Decimal(19, 4)
  bookBalance      Decimal              @db.Decimal(19, 4)
  difference       Decimal              @db.Decimal(19, 4)
  status           ReconciliationStatus @default(IN_PROGRESS)
  reconciledBy     String?
  reconciledAt     DateTime?
  notes            String?
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  bankAccount      BankAccount          @relation(fields: [bankAccountId], references: [id])

  @@index([bankAccountId, statementDate])
}

model Product {
  id                     String                     @id @default(cuid())
  organizationId         String
  sku                    String
  name                   String
  description            String?
  productType            ProductType
  category               String?
  unitOfMeasureId        String?
  purchasePrice          Decimal                    @default(0) @db.Decimal(19, 4)
  sellingPrice           Decimal                    @default(0) @db.Decimal(19, 4)
  trackInventory         Boolean                    @default(true)
  reorderLevel           Decimal?                   @db.Decimal(12, 4)
  reorderQuantity        Decimal?                   @db.Decimal(12, 4)
  taxable                Boolean                    @default(true)
  defaultTaxRate         Decimal                    @default(0) @db.Decimal(5, 2)
  incomeAccountId        String?
  expenseAccountId       String?
  assetAccountId         String?
  isActive               Boolean                    @default(true)
  createdAt              DateTime                   @default(now())
  updatedAt              DateTime                   @updatedAt
  branchId               String?
  componentAssemblyLines AssemblyLine[]
  finishedAssemblies     AssemblyTransaction[]
  billItems              BillItem[]
  billOfMaterials        BillOfMaterial[]
  bomComponentLines      BillOfMaterialLine[]
  certificatesOfAnalysis CertificateOfAnalysis[]
  costRevaluations       CostRevaluation[]
  costVariances          CostVariance[]
  creditNoteItems        CreditNoteItem[]
  cycleCountItems        CycleCountItem[]
  debitNoteItems         DebitNoteItem[]
  demandForecasts        DemandForecast[]
  inventoryItems         InventoryItem[]
  lots                   InventoryLot[]
  serials                InventorySerial[]
  valuations             InventoryValuation[]
  invoiceItems           InvoiceItem[]
  itemMaster             ItemMaster?
  landedCostAllocations  LandedCostAllocationItem[]
  nonConformanceReports  NonConformanceReport[]
  priceListItems         PriceListItem[]
  Branch                 Branch?                    @relation(fields: [branchId], references: [id])
  organization           Organization               @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  unitOfMeasure          UnitOfMeasure?             @relation(fields: [unitOfMeasureId], references: [id])
  productPlannings       ProductPlanning[]
  productVariant         ProductVariant?
  poItems                PurchaseOrderItem[]
  qualityHolds           QualityHold[]
  qualityInspections     QualityInspection[]
  reorderPolicies        ReorderPolicy[]
  routings               Routing[]
  safetyStocks           SafetyStock[]
  spareParts             SparePart[]
  standardCosts          StandardCost[]
  stockMovements         StockMovement[]
  reservations           StockReservation[]
  transferOrderLines     TransferOrderLine[]
  workOrders             WorkOrder[]
  workOrderMaterials     WorkOrderMaterial[]

  @@unique([organizationId, sku])
  @@index([organizationId, productType])
}

model RecurringTemplate {
  id               String                @id @default(cuid())
  organizationId   String
  branchId         String?
  name             String
  templateType     RecurringTemplateType
  frequency        RecurringFrequency
  timezone         String                @default("UTC")
  startDate        DateTime              @default(now())
  endDate          DateTime?
  dayOfMonth       Int?
  weekday          Int?
  cronExpression   String?
  nextRunAt        DateTime?
  lastRunAt        DateTime?
  payload          Json
  status           RecurringStatus       @default(ACTIVE)
  approvalRequired Boolean               @default(false)
  approverRoles    String[]              @default([])
  maxExecutions    Int?
  executedCount    Int                   @default(0)
  notes            String?
  createdById      String
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  executions       RecurringExecution[]
  branch           Branch?               @relation(fields: [branchId], references: [id])
  createdBy        User                  @relation(fields: [createdById], references: [id])
  organization     Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, status])
  @@index([nextRunAt])
}

model RecurringExecution {
  id              String            @id @default(cuid())
  organizationId  String
  templateId      String
  runAt           DateTime          @default(now())
  status          ExecutionStatus   @default(PENDING)
  attempt         Int               @default(1)
  transactionId   String?
  invoiceId       String?
  billId          String?
  paymentId       String?
  message         String?
  errorStack      String?
  payloadSnapshot Json?
  createdById     String?
  createdAt       DateTime          @default(now())
  bill            Bill?             @relation(fields: [billId], references: [id])
  createdBy       User?             @relation(fields: [createdById], references: [id])
  invoice         Invoice?          @relation(fields: [invoiceId], references: [id])
  organization    Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  payment         Payment?          @relation(fields: [paymentId], references: [id])
  template        RecurringTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  transaction     Transaction?      @relation(fields: [transactionId], references: [id])

  @@index([organizationId, templateId])
  @@index([runAt])
  @@index([status])
}

model InventoryItem {
  id                String   @id @default(cuid())
  productId         String
  warehouseLocation String   @default("Main")
  quantityOnHand    Decimal  @db.Decimal(12, 4)
  quantityReserved  Decimal  @default(0) @db.Decimal(12, 4)
  quantityAvailable Decimal  @db.Decimal(12, 4)
  averageCost       Decimal  @default(0) @db.Decimal(19, 4)
  totalValue        Decimal  @default(0) @db.Decimal(19, 4)
  updatedAt         DateTime @updatedAt
  product           Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, warehouseLocation])
  @@index([productId])
}

model StockMovement {
  id                String       @id @default(cuid())
  productId         String
  movementType      MovementType
  quantity          Decimal      @db.Decimal(12, 4)
  unitCost          Decimal      @default(0) @db.Decimal(19, 4)
  totalCost         Decimal      @default(0) @db.Decimal(19, 4)
  warehouseLocation String       @default("Main")
  referenceType     String?
  referenceId       String?
  notes             String?
  movementDate      DateTime     @default(now())
  transactionId     String?
  createdAt         DateTime     @default(now())
  product           Product      @relation(fields: [productId], references: [id])

  @@index([productId, movementDate])
  @@index([referenceType, referenceId])
}

model InventoryWarehouse {
  id                 String               @id @default(cuid())
  organizationId     String
  branchId           String?
  code               String
  name               String
  type               WarehouseType        @default(GENERAL)
  isDefault          Boolean              @default(false)
  isActive           Boolean              @default(true)
  address            String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  assemblyLines      AssemblyLine[]
  costRevaluations   CostRevaluation[]
  cycleCounts        CycleCount[]
  demandForecasts    DemandForecast[]
  bins               InventoryBin[]
  lots               InventoryLot[]
  serials            InventorySerial[]
  valuations         InventoryValuation[]
  branch             Branch?              @relation(fields: [branchId], references: [id])
  organization       Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  qualityHolds       QualityHold[]
  reorderPolicies    ReorderPolicy[]
  safetyStocks       SafetyStock[]
  reservations       StockReservation[]
  transferOrdersFrom TransferOrder[]      @relation("TransferFromWarehouse")
  transferOrdersTo   TransferOrder[]      @relation("TransferToWarehouse")

  @@unique([organizationId, code])
  @@index([organizationId])
  @@index([branchId])
}

model InventoryBin {
  id          String             @id @default(cuid())
  warehouseId String
  code        String
  name        String
  type        BinType            @default(STANDARD)
  isActive    Boolean            @default(true)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  warehouse   InventoryWarehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  lots        InventoryLot[]
  serials     InventorySerial[]

  @@unique([warehouseId, code])
  @@index([warehouseId])
  @@index([type])
}

model InventoryLot {
  id                String              @id @default(cuid())
  organizationId    String
  productId         String
  warehouseId       String?
  binId             String?
  lotNumber         String
  status            LotStatus           @default(ACTIVE)
  quantityOnHand    Decimal             @default(0) @db.Decimal(12, 4)
  quantityReserved  Decimal             @default(0) @db.Decimal(12, 4)
  quantityAvailable Decimal             @default(0) @db.Decimal(12, 4)
  receivedDate      DateTime?           @default(now())
  expiryDate        DateTime?
  notes             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  assemblyLines     AssemblyLine[]
  bin               InventoryBin?       @relation(fields: [binId], references: [id])
  organization      Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product           Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse         InventoryWarehouse? @relation(fields: [warehouseId], references: [id])
  serials           InventorySerial[]
  transferLines     TransferOrderLine[]

  @@unique([organizationId, productId, lotNumber])
  @@index([organizationId, status])
  @@index([warehouseId, binId])
}

model InventorySerial {
  id             String              @id @default(cuid())
  organizationId String
  productId      String
  lotId          String?
  warehouseId    String?
  binId          String?
  workOrderId    String?
  serialNumber   String
  status         SerialStatus        @default(AVAILABLE)
  receivedAt     DateTime?           @default(now())
  assignedAt     DateTime?
  consumedAt     DateTime?
  notes          String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  bin            InventoryBin?       @relation(fields: [binId], references: [id])
  lot            InventoryLot?       @relation(fields: [lotId], references: [id])
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product        Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse      InventoryWarehouse? @relation(fields: [warehouseId], references: [id])
  workOrder      WorkOrder?          @relation(fields: [workOrderId], references: [id])

  @@unique([organizationId, serialNumber])
  @@index([productId])
  @@index([warehouseId, binId])
}

model TransferOrder {
  id                  String              @id @default(cuid())
  organizationId      String
  fromWarehouseId     String
  toWarehouseId       String
  status              TransferOrderStatus @default(DRAFT)
  expectedShipDate    DateTime?
  expectedReceiveDate DateTime?
  shippedAt           DateTime?
  receivedAt          DateTime?
  reference           String?
  notes               String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  fromWarehouse       InventoryWarehouse  @relation("TransferFromWarehouse", fields: [fromWarehouseId], references: [id])
  organization        Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  toWarehouse         InventoryWarehouse  @relation("TransferToWarehouse", fields: [toWarehouseId], references: [id])
  lines               TransferOrderLine[]

  @@index([organizationId, status])
  @@index([fromWarehouseId])
  @@index([toWarehouseId])
}

model TransferOrderLine {
  id                String        @id @default(cuid())
  transferOrderId   String
  productId         String
  quantity          Decimal       @db.Decimal(12, 4)
  unitOfMeasureId   String?
  lotId             String?
  notes             String?
  lot               InventoryLot? @relation(fields: [lotId], references: [id])
  product         Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  transferOrder   TransferOrder @relation(fields: [transferOrderId], references: [id], onDelete: Cascade)

  @@index([transferOrderId])
  @@index([productId])
}

model WorkCenter {
  id              String        @id @default(cuid())
  organizationId  String
  code            String
  name            String
  description     String?
  costRate        Decimal       @default(0) @db.Decimal(19, 4)
  capacityPerHour Decimal       @default(0) @db.Decimal(12, 4)
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  routingSteps    RoutingStep[]
  organization    Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  workOrders      WorkOrder[]

  @@unique([organizationId, code])
  @@index([organizationId])
}

model BillOfMaterial {
  id                   String                @id @default(cuid())
  organizationId       String
  productId            String
  name                 String
  version              String                @default("1.0")
  status               BomStatus             @default(DRAFT)
  isDefault            Boolean               @default(false)
  revisionNotes        String?
  yieldPercent         Decimal               @default(100) @db.Decimal(6, 2)
  scrapPercent         Decimal               @default(0) @db.Decimal(6, 2)
  effectiveFrom        DateTime?             @default(now())
  effectiveTo          DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  assemblyTransactions AssemblyTransaction[]
  organization         Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product              Product               @relation(fields: [productId], references: [id], onDelete: Cascade)
  lines                BillOfMaterialLine[]
  workOrders           WorkOrder[]
  standardCosts        StandardCost[]

  @@unique([organizationId, productId, version])
  @@index([organizationId, status])
}

model BillOfMaterialLine {
  id           String         @id @default(cuid())
  bomId        String
  componentId  String
  quantityPer  Decimal        @db.Decimal(12, 4)
  scrapPercent Decimal        @default(0) @db.Decimal(6, 2)
  backflush    Boolean        @default(true)
  operationSeq Int?
  bom          BillOfMaterial @relation(fields: [bomId], references: [id], onDelete: Cascade)
  component    Product        @relation(fields: [componentId], references: [id], onDelete: Cascade)

  @@index([bomId])
  @@index([componentId])
}

model Routing {
  id             String        @id @default(cuid())
  organizationId String
  productId      String
  name           String
  version        String        @default("1.0")
  status         RoutingStatus @default(DRAFT)
  isDefault      Boolean       @default(false)
  notes          String?
  effectiveFrom  DateTime?     @default(now())
  effectiveTo    DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organization   Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product        Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  steps          RoutingStep[]
  workOrders     WorkOrder[]
  standardCosts  StandardCost[]

  @@unique([organizationId, productId, version])
  @@index([organizationId, status])
}

model RoutingStep {
  id                   String               @id @default(cuid())
  routingId            String
  workCenterId         String?
  sequence             Int
  name                 String
  description          String?
  setupTimeMins        Int                  @default(0)
  runTimeMinsPerUnit   Int                  @default(0)
  laborTimeMinsPerUnit Int                  @default(0)
  queueTimeMins        Int                  @default(0)
  moveTimeMins         Int                  @default(0)
  routing              Routing              @relation(fields: [routingId], references: [id], onDelete: Cascade)
  workCenter           WorkCenter?          @relation(fields: [workCenterId], references: [id])
  operations           WorkOrderOperation[]

  @@unique([routingId, sequence])
  @@index([routingId])
  @@index([workCenterId])
}

model WorkOrder {
  id                String               @id @default(cuid())
  organizationId    String
  productId         String
  branchId          String?
  bomId             String?
  routingId         String?
  workCenterId      String?
  workOrderNumber   String               @unique
  status            WorkOrderStatus      @default(PLANNED)
  quantityPlanned   Decimal              @db.Decimal(12, 4)
  quantityCompleted Decimal              @default(0) @db.Decimal(12, 4)
  quantityScrapped  Decimal              @default(0) @db.Decimal(12, 4)
  startDate         DateTime?            @default(now())
  dueDate           DateTime?
  completedAt       DateTime?
  priority          Int                  @default(3)
  notes             String?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  serials           InventorySerial[]
  bom               BillOfMaterial?      @relation(fields: [bomId], references: [id])
  branch            Branch?              @relation(fields: [branchId], references: [id])
  organization      Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product           Product              @relation(fields: [productId], references: [id], onDelete: Cascade)
  routing           Routing?             @relation(fields: [routingId], references: [id])
  workCenter        WorkCenter?          @relation(fields: [workCenterId], references: [id])
  materials         WorkOrderMaterial[]
  operations        WorkOrderOperation[]

  @@index([organizationId, status])
  @@index([productId])
  @@index([branchId])
}

model WorkOrderMaterial {
  id               String    @id @default(cuid())
  workOrderId      String
  componentId      String
  requiredQuantity Decimal   @db.Decimal(12, 4)
  issuedQuantity   Decimal   @default(0) @db.Decimal(12, 4)
  scrapPercent     Decimal   @default(0) @db.Decimal(6, 2)
  backflush        Boolean   @default(true)
  component        Product   @relation(fields: [componentId], references: [id], onDelete: Cascade)
  workOrder        WorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@index([workOrderId])
  @@index([componentId])
}

model WorkOrderOperation {
  id            String                   @id @default(cuid())
  workOrderId   String
  routingStepId String?
  sequence      Int
  status        WorkOrderOperationStatus @default(PENDING)
  setupTimeMins Int                      @default(0)
  runTimeMins   Int                      @default(0)
  laborTimeMins Int                      @default(0)
  startedAt     DateTime?
  completedAt   DateTime?
  routingStep   RoutingStep?             @relation(fields: [routingStepId], references: [id])
  workOrder     WorkOrder                @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@unique([workOrderId, sequence])
  @@index([workOrderId])
  @@index([routingStepId])
}

model TaxConfiguration {
  id             String       @id @default(cuid())
  organizationId String
  taxName        String
  taxType        TaxType
  rate           Decimal      @db.Decimal(5, 2)
  description    String?
  taxAccountId   String?
  isActive       Boolean      @default(true)
  effectiveFrom  DateTime
  effectiveTo    DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, isActive])
}

model FiscalPeriod {
  id             String       @id @default(cuid())
  organizationId String
  name           String
  startDate      DateTime
  endDate        DateTime
  fiscalYear     Int
  quarter        Int?
  month          Int?
  status         PeriodStatus @default(OPEN)
  closedAt       DateTime?
  closedBy       String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, startDate, endDate])
  @@index([organizationId, fiscalYear])
}

model Budget {
  id           String         @id @default(cuid())
  accountId    String
  fiscalYear   Int
  month        Int?
  budgetAmount Decimal        @db.Decimal(19, 4)
  actualAmount Decimal        @default(0) @db.Decimal(19, 4)
  variance     Decimal        @default(0) @db.Decimal(19, 4)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  account      ChartOfAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@unique([accountId, fiscalYear, month])
  @@index([accountId, fiscalYear])
}

model AuditLog {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  entityType     String
  entityId       String
  action         AuditAction
  changes        Json?
  ipAddress      String?
  userAgent      String?
  timestamp      DateTime     @default(now())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id])

  @@index([organizationId, entityType, entityId])
  @@index([userId, timestamp])
}

model TaxRate {
  id              String           @id @default(cuid())
  organizationId  String
  name            String
  taxType         TaxType
  rate            Decimal          @db.Decimal(5, 2)
  country         String
  isDefault       Boolean          @default(false)
  isActive        Boolean          @default(true)
  effectiveFrom   DateTime
  effectiveTo     DateTime?
  description     String?
  taxCode         String?
  claimable       Boolean          @default(true)
  requiresEFRIS   Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  billItems       BillItem[]
  creditNoteItems CreditNoteItem[] @relation("CreditNoteItemTaxRate")
  debitNoteItems  DebitNoteItem[]  @relation("DebitNoteItemTaxRate")
  invoiceItems    InvoiceItem[]
  organization    Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, country])
  @@index([taxType, isActive])
}

model WHTRule {
  id                String           @id @default(cuid())
  organizationId    String
  name              String
  country           String
  whtType           WHTType
  rate              Decimal          @db.Decimal(5, 2)
  threshold         Decimal?         @db.Decimal(15, 2)
  isActive          Boolean          @default(true)
  description       String?
  effectiveFrom     DateTime
  effectiveTo       DateTime?
  serviceCategories String[]
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  organization      Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  whtTransactions   WHTTransaction[]

  @@index([organizationId, country])
  @@index([whtType, isActive])
}

model WHTTransaction {
  id               String    @id @default(cuid())
  organizationId   String
  whtRuleId        String
  transactionId    String?
  billId           String?
  paymentId        String?
  vendorId         String
  grossAmount      Decimal   @db.Decimal(15, 2)
  whtRate          Decimal   @db.Decimal(5, 2)
  whtAmount        Decimal   @db.Decimal(15, 2)
  netAmount        Decimal   @db.Decimal(15, 2)
  whtDate          DateTime
  description      String?
  whtCertificateNo String?
  filed            Boolean   @default(false)
  filedDate        DateTime?
  taxPeriod        String?
  metadata         Json?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  Bill             Bill?     @relation(fields: [billId], references: [id])
  vendor           Vendor    @relation(fields: [vendorId], references: [id])
  whtRule          WHTRule   @relation(fields: [whtRuleId], references: [id])

  @@index([organizationId, whtDate])
  @@index([vendorId])
  @@index([filed, taxPeriod])
}

model TaxReturn {
  id               String          @id @default(cuid())
  organizationId   String
  returnType       TaxReturnType
  taxPeriod        String
  startDate        DateTime
  endDate          DateTime
  country          String
  status           TaxReturnStatus @default(DRAFT)
  totalSales       Decimal         @default(0) @db.Decimal(15, 2)
  totalPurchases   Decimal         @default(0) @db.Decimal(15, 2)
  outputVAT        Decimal         @default(0) @db.Decimal(15, 2)
  inputVAT         Decimal         @default(0) @db.Decimal(15, 2)
  netVAT           Decimal         @default(0) @db.Decimal(15, 2)
  whtWithheld      Decimal         @default(0) @db.Decimal(15, 2)
  payeWithheld     Decimal         @default(0) @db.Decimal(15, 2)
  filedDate        DateTime?
  filedBy          String?
  referenceNumber  String?
  paymentDueDate   DateTime?
  paymentDate      DateTime?
  paymentAmount    Decimal?        @db.Decimal(15, 2)
  paymentReference String?
  returnData       Json?
  attachments      String[]
  notes            String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  organization     Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, returnType, taxPeriod])
  @@index([organizationId, status])
  @@index([taxPeriod, returnType])
}

model AssetCategory {
  id                    String             @id @default(cuid())
  organizationId        String
  name                  String
  code                  String
  description           String?
  assetAccountId        String
  depreciationAccountId String
  expenseAccountId      String
  defaultMethod         DepreciationMethod @default(STRAIGHT_LINE)
  defaultLifeYears      Int
  defaultSalvagePercent Decimal            @default(0) @db.Decimal(5, 2)
  ugandaTaxRate         Decimal?           @db.Decimal(5, 2)
  isActive              Boolean            @default(true)
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt
  assets                Asset[]
  assetAccount          ChartOfAccount     @relation("AssetAccount", fields: [assetAccountId], references: [id])
  depreciationAccount   ChartOfAccount     @relation("DepreciationAccount", fields: [depreciationAccountId], references: [id])
  expenseAccount        ChartOfAccount     @relation("ExpenseAccount", fields: [expenseAccountId], references: [id])
  organization          Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
  @@index([organizationId, isActive])
}

model Asset {
  id                      String                 @id @default(cuid())
  organizationId          String
  branchId                String?
  categoryId              String
  assetNumber             String
  name                    String
  description             String?
  purchaseDate            DateTime
  purchasePrice           Decimal                @db.Decimal(19, 4)
  vendor                  String?
  invoiceNumber           String?
  depreciationMethod      DepreciationMethod
  usefulLifeYears         Int
  usefulLifeUnits         Int?
  salvageValue            Decimal                @default(0) @db.Decimal(19, 4)
  depreciationStartDate   DateTime
  currentBookValue        Decimal                @db.Decimal(19, 4)
  accumulatedDepreciation Decimal                @default(0) @db.Decimal(19, 4)
  location                String?
  serialNumber            String?
  model                   String?
  manufacturer            String?
  insurancePolicy         String?
  insuranceExpiry         DateTime?
  warrantyExpiry          DateTime?
  status                  AssetStatus            @default(ACTIVE)
  disposalDate            DateTime?
  disposalMethod          String?
  disposalPrice           Decimal?               @db.Decimal(19, 4)
  disposalNotes           String?
  tags                    String[]
  customFields            Json?
  attachments             String[]
  notes                   String?
  createdAt               DateTime               @default(now())
  updatedAt               DateTime               @updatedAt
  branch                  Branch?                @relation(fields: [branchId], references: [id])
  category                AssetCategory          @relation(fields: [categoryId], references: [id])
  organization            Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  depreciationSchedule    AssetDepreciation[]
  disposalRecord          AssetDisposal?
  maintenanceRecords      AssetMaintenance[]
  maintenancePlans        MaintenancePlan[]
  maintenanceWorkOrders   MaintenanceWorkOrder[]

  @@unique([organizationId, assetNumber])
  @@index([organizationId, status])
  @@index([categoryId])
  @@index([branchId])
  @@index([purchaseDate])
}

model AssetDepreciation {
  id                      String             @id @default(cuid())
  organizationId          String
  assetId                 String
  period                  String
  periodStartDate         DateTime
  periodEndDate           DateTime
  depreciationMethod      DepreciationMethod
  openingBookValue        Decimal            @db.Decimal(19, 4)
  depreciationAmount      Decimal            @db.Decimal(19, 4)
  accumulatedDepreciation Decimal            @db.Decimal(19, 4)
  closingBookValue        Decimal            @db.Decimal(19, 4)
  taxDepreciationAmount   Decimal?           @db.Decimal(19, 4)
  taxBookValue            Decimal?           @db.Decimal(19, 4)
  posted                  Boolean            @default(false)
  transactionId           String?
  postedDate              DateTime?
  postedBy                String?
  calculationDetails      Json?
  notes                   String?
  createdAt               DateTime           @default(now())
  updatedAt               DateTime           @updatedAt
  asset                   Asset              @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@unique([assetId, period])
  @@index([organizationId, period])
  @@index([posted])
}

model AssetDisposal {
  id                  String         @id @default(cuid())
  organizationId      String
  assetId             String         @unique
  disposalDate        DateTime
  disposalMethod      DisposalMethod
  disposalPrice       Decimal        @default(0) @db.Decimal(19, 4)
  costAtDisposal      Decimal        @db.Decimal(19, 4)
  accDepAtDisposal    Decimal        @db.Decimal(19, 4)
  bookValueAtDisposal Decimal        @db.Decimal(19, 4)
  gainLoss            Decimal        @db.Decimal(19, 4)
  gainLossType        String
  buyer               String?
  buyerTIN            String?
  disposalInvoiceNo   String?
  posted              Boolean        @default(false)
  transactionId       String?
  postedDate          DateTime?
  postedBy            String?
  reason              String?
  approvedBy          String?
  approvedDate        DateTime?
  notes               String?
  attachments         String[]
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  asset               Asset          @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([organizationId, disposalDate])
  @@index([posted])
}

model AssetMaintenance {
  id                   String            @id @default(cuid())
  organizationId       String
  assetId              String
  maintenanceType      MaintenanceType
  maintenanceDate      DateTime
  description          String
  vendor               String?
  cost                 Decimal           @default(0) @db.Decimal(19, 4)
  isScheduled          Boolean           @default(false)
  nextMaintenanceDate  DateTime?
  nextMaintenanceMiles Int?
  status               MaintenanceStatus @default(COMPLETED)
  startDate            DateTime?
  completionDate       DateTime?
  meterReading         Int?
  performedBy          String?
  billId               String?
  notes                String?
  attachments          String[]
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  asset                Asset             @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([organizationId, assetId])
  @@index([maintenanceDate])
  @@index([nextMaintenanceDate])
}

model CreditNote {
  id               String                  @id @default(cuid())
  organizationId   String
  creditNoteNumber String
  invoiceId        String?
  customerId       String
  branchId         String?
  subtotal         Decimal                 @default(0) @db.Decimal(19, 4)
  taxAmount        Decimal                 @default(0) @db.Decimal(19, 4)
  totalAmount      Decimal                 @default(0) @db.Decimal(19, 4)
  appliedAmount    Decimal                 @default(0) @db.Decimal(19, 4)
  remainingAmount  Decimal                 @default(0) @db.Decimal(19, 4)
  creditDate       DateTime                @default(now())
  reason           CreditNoteReason
  description      String
  internalNotes    String?
  status           CreditNoteStatus        @default(DRAFT)
  approvedBy       String?
  approvedAt       DateTime?
  approvalNotes    String?
  voidedBy         String?
  voidedAt         DateTime?
  voidReason       String?
  isPosted         Boolean                 @default(false)
  postedAt         DateTime?
  transactionId    String?
  attachments      String[]
  createdBy        String
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  branch           Branch?                 @relation(fields: [branchId], references: [id])
  customer         Customer                @relation(fields: [customerId], references: [id])
  invoice          Invoice?                @relation(fields: [invoiceId], references: [id])
  organization     Organization            @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  transaction      Transaction?            @relation(fields: [transactionId], references: [id])
  applications     CreditNoteApplication[]
  lineItems        CreditNoteItem[]

  @@unique([organizationId, creditNoteNumber])
  @@index([organizationId, customerId])
  @@index([invoiceId])
  @@index([status])
  @@index([creditDate])
}

model CreditNoteItem {
  id           String          @id @default(cuid())
  creditNoteId String
  productId    String?
  description  String
  quantity     Decimal         @db.Decimal(12, 4)
  unitPrice    Decimal         @db.Decimal(19, 4)
  taxRateId    String?
  taxRate      Decimal         @default(0) @db.Decimal(5, 2)
  taxAmount    Decimal         @default(0) @db.Decimal(19, 4)
  subtotal     Decimal         @db.Decimal(19, 4)
  totalAmount  Decimal         @db.Decimal(19, 4)
  accountId    String?
  createdAt    DateTime        @default(now())
  account      ChartOfAccount? @relation(fields: [accountId], references: [id])
  creditNote   CreditNote      @relation(fields: [creditNoteId], references: [id], onDelete: Cascade)
  product      Product?        @relation(fields: [productId], references: [id])
  taxRateRef   TaxRate?        @relation("CreditNoteItemTaxRate", fields: [taxRateId], references: [id])

  @@index([creditNoteId])
}

model CreditNoteApplication {
  id           String     @id @default(cuid())
  creditNoteId String
  invoiceId    String
  amount       Decimal    @db.Decimal(19, 4)
  appliedDate  DateTime   @default(now())
  appliedBy    String
  notes        String?
  creditNote   CreditNote @relation(fields: [creditNoteId], references: [id], onDelete: Cascade)
  invoice      Invoice    @relation(fields: [invoiceId], references: [id])

  @@index([creditNoteId])
  @@index([invoiceId])
}

model DebitNote {
  id              String          @id @default(cuid())
  organizationId  String
  debitNoteNumber String
  invoiceId       String?
  customerId      String
  branchId        String?
  subtotal        Decimal         @default(0) @db.Decimal(19, 4)
  taxAmount       Decimal         @default(0) @db.Decimal(19, 4)
  totalAmount     Decimal         @default(0) @db.Decimal(19, 4)
  paidAmount      Decimal         @default(0) @db.Decimal(19, 4)
  balanceAmount   Decimal         @default(0) @db.Decimal(19, 4)
  debitDate       DateTime        @default(now())
  dueDate         DateTime?
  reason          DebitNoteReason
  description     String
  internalNotes   String?
  status          DebitNoteStatus @default(DRAFT)
  approvedBy      String?
  approvedAt      DateTime?
  approvalNotes   String?
  voidedBy        String?
  voidedAt        DateTime?
  voidReason      String?
  isPosted        Boolean         @default(false)
  postedAt        DateTime?
  transactionId   String?
  attachments     String[]
  createdBy       String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  branch          Branch?         @relation(fields: [branchId], references: [id])
  customer        Customer        @relation(fields: [customerId], references: [id])
  invoice         Invoice?        @relation(fields: [invoiceId], references: [id])
  organization    Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  transaction     Transaction?    @relation(fields: [transactionId], references: [id])
  lineItems       DebitNoteItem[]
  payments        Payment[]       @relation("DebitNotePayments")

  @@unique([organizationId, debitNoteNumber])
  @@index([organizationId, customerId])
  @@index([invoiceId])
  @@index([status])
  @@index([debitDate])
}

model DebitNoteItem {
  id          String          @id @default(cuid())
  debitNoteId String
  productId   String?
  description String
  quantity    Decimal         @db.Decimal(12, 4)
  unitPrice   Decimal         @db.Decimal(19, 4)
  taxRateId   String?
  taxRate     Decimal         @default(0) @db.Decimal(5, 2)
  taxAmount   Decimal         @default(0) @db.Decimal(19, 4)
  subtotal    Decimal         @db.Decimal(19, 4)
  totalAmount Decimal         @db.Decimal(19, 4)
  accountId   String?
  createdAt   DateTime        @default(now())
  account     ChartOfAccount? @relation(fields: [accountId], references: [id])
  debitNote   DebitNote       @relation(fields: [debitNoteId], references: [id], onDelete: Cascade)
  product     Product?        @relation(fields: [productId], references: [id])
  taxRateRef  TaxRate?        @relation("DebitNoteItemTaxRate", fields: [taxRateId], references: [id])

  @@index([debitNoteId])
}

model BankFeed {
  id             String            @id @default(cuid())
  organizationId String
  bankAccountId  String?
  feedName       String
  feedType       String
  externalId     String?
  status         String            @default("ACTIVE")
  lastSyncAt     DateTime?
  nextSyncAt     DateTime?
  metadata       Json?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  bankAccount    BankAccount?      @relation(fields: [bankAccountId], references: [id])
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  transactions   BankTransaction[]

  @@index([organizationId, status])
}

model BankTransaction {
  id                   String       @id @default(cuid())
  organizationId       String
  bankFeedId           String
  externalId           String?
  transactionDate      DateTime
  amount               Decimal      @db.Decimal(19, 4)
  description          String
  payee                String?
  referenceNo          String?
  transactionType      String
  status               String       @default("PENDING")
  matchedPaymentId     String?
  matchedTransactionId String?
  confidenceScore      Decimal?     @db.Decimal(5, 2)
  createdAt            DateTime     @default(now())
  bankFeed             BankFeed     @relation(fields: [bankFeedId], references: [id], onDelete: Cascade)
  organization         Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, transactionDate])
  @@index([status, matchedPaymentId])
}

model Document {
  id             String       @id @default(cuid())
  organizationId String
  fileName       String
  fileType       String
  fileSize       Int
  fileUrl        String
  status         String       @default("UPLOADED")
  extractedText  String?
  ocrConfidence  Decimal?     @db.Decimal(5, 2)
  transactionId  String?
  invoiceId      String?
  billId         String?
  linkedEntities Json?
  uploadedBy     String
  uploadedAt     DateTime     @default(now())
  tags           String[]
  notes          String?
  createdAt      DateTime     @default(now())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  uploadedByUser User         @relation(fields: [uploadedBy], references: [id])

  @@index([organizationId, status])
  @@index([transactionId, invoiceId, billId])
}

model Project {
  id             String        @id @default(cuid())
  organizationId String
  code           String
  name           String
  description    String?
  status         String        @default("ACTIVE")
  startDate      DateTime
  endDate        DateTime?
  budget         Decimal?      @db.Decimal(19, 4)
  currency       String        @default("USD")
  managerId      String?
  customerId     String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  customer       Customer?     @relation(fields: [customerId], references: [id])
  manager        User?         @relation(fields: [managerId], references: [id])
  organization   Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  costs          ProjectCost[]
  tasks          ProjectTask[]
  timeEntries    TimeEntry[]

  @@unique([organizationId, code])
  @@index([organizationId, status])
}

model ProjectTask {
  id          String    @id @default(cuid())
  projectId   String
  name        String
  description String?
  status      String    @default("TODO")
  startDate   DateTime?
  endDate     DateTime?
  assignedTo  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  owner       User?     @relation(fields: [assignedTo], references: [id])
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, status])
}

model ProjectCost {
  id            String   @id @default(cuid())
  projectId     String
  description   String
  amount        Decimal  @db.Decimal(19, 4)
  category      String?
  transactionId String?
  billId        String?
  invoiceId     String?
  createdAt     DateTime @default(now())
  project       Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model Company {
  id             String        @id @default(cuid())
  organizationId String
  name           String
  type           String
  industry       String?
  website        String?
  email          String?
  phone          String?
  address        String?
  city           String?
  country        String?
  taxId          String?
  status         String        @default("ACTIVE")
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  activities     Activity[]
  organization   Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  contacts       Contact[]
  opportunities  Opportunity[]

  @@index([organizationId, type])
}

model Contact {
  id             String       @id @default(cuid())
  organizationId String
  companyId      String
  firstName      String
  lastName       String
  email          String?
  phone          String?
  title          String?
  notes          String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  activities     Activity[]
  company        Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, companyId])
}

model Opportunity {
  id             String       @id @default(cuid())
  organizationId String
  companyId      String
  name           String
  value          Decimal?     @db.Decimal(19, 4)
  currency       String       @default("USD")
  stage          String
  probability    Decimal      @default(50) @db.Decimal(5, 2)
  closedDate     DateTime?
  reason         String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  company        Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, stage])
}

model Activity {
  id             String       @id @default(cuid())
  organizationId String
  companyId      String
  contactId      String?
  type           String
  subject        String
  description    String?
  dueDate        DateTime?
  completedAt    DateTime?
  createdBy      String
  createdAt      DateTime     @default(now())
  company        Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact        Contact?     @relation(fields: [contactId], references: [id])
  createdByUser  User         @relation(fields: [createdBy], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, companyId])
}

model Employee {
  id                 String              @id @default(cuid())
  organizationId     String
  userId             String?             @unique
  employeeNumber     String
  firstName          String
  middleName         String?
  lastName           String
  email              String?
  phone              String?
  dateOfBirth        DateTime?
  hireDate           DateTime
  terminationDate    DateTime?
  status             EmployeeStatus      @default(ACTIVE)
  jobTitleId         String?
  departmentId       String?
  positionId         String?
  managerId          String?
  workLocation       String?
  employmentType     EmploymentType      @default(FULL_TIME)
  payrollCurrency    String              @default("USD")
  baseSalary         Decimal?            @db.Decimal(19, 4)
  payFrequency       PayFrequency        @default(MONTHLY)
  taxIdNumber        String?
  bankAccountNumber  String?
  bankName           String?
  address            String?
  city               String?
  state              String?
  postalCode         String?
  country            String?
  emergencyContact   String?
  emergencyPhone     String?
  notes              String?
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  benefitEnrollments BenefitEnrollment[]
  department         Department?         @relation(fields: [departmentId], references: [id])
  jobTitle           JobTitle?           @relation(fields: [jobTitleId], references: [id])
  manager            Employee?           @relation("EmployeeHierarchy", fields: [managerId], references: [id])
  directReports      Employee[]          @relation("EmployeeHierarchy")
  organization       Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  position           Position?           @relation(fields: [positionId], references: [id])
  user               User?               @relation(fields: [userId], references: [id])
  expenseClaims      ExpenseClaim[]
  leaveRequests      LeaveRequest[]
  payrollItems       PayrollItem[]
  performanceReviews PerformanceReview[] @relation("EmployeeReviews")
  reviewsAsReviewer  PerformanceReview[] @relation("ReviewerReviews")
  serviceTechnician  ServiceTechnician?
  timeEntries        TimeEntry[]

  @@unique([organizationId, employeeNumber])
  @@index([organizationId, status])
  @@index([departmentId])
  @@index([managerId])
}

model Department {
  id             String       @id @default(cuid())
  organizationId String
  code           String
  name           String
  description    String?
  parentId       String?
  managerId      String?
  costCenterId   String?
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent         Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children       Department[] @relation("DepartmentHierarchy")
  employees      Employee[]
  positions      Position[]

  @@unique([organizationId, code])
  @@index([organizationId])
  @@index([parentId])
}

model JobTitle {
  id             String       @id @default(cuid())
  organizationId String
  code           String
  title          String
  description    String?
  level          String?
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  employees      Employee[]
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  positions      Position[]

  @@unique([organizationId, code])
  @@index([organizationId])
}

model Position {
  id             String         @id @default(cuid())
  organizationId String
  positionNumber String
  jobTitleId     String
  departmentId   String
  status         PositionStatus @default(OPEN)
  description    String?
  requirements   String?
  openedDate     DateTime       @default(now())
  closedDate     DateTime?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  employees      Employee[]
  department     Department     @relation(fields: [departmentId], references: [id])
  jobTitle       JobTitle       @relation(fields: [jobTitleId], references: [id])
  organization   Organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, positionNumber])
  @@index([organizationId, status])
}

model PayrollRun {
  id               String        @id @default(cuid())
  organizationId   String
  payrollNumber    String
  payPeriodStart   DateTime
  payPeriodEnd     DateTime
  paymentDate      DateTime
  status           PayrollStatus @default(DRAFT)
  totalGrossPay    Decimal       @default(0) @db.Decimal(19, 4)
  totalDeductions  Decimal       @default(0) @db.Decimal(19, 4)
  totalNetPay      Decimal       @default(0) @db.Decimal(19, 4)
  totalEmployerTax Decimal       @default(0) @db.Decimal(19, 4)
  transactionId    String?       @unique
  notes            String?
  processedBy      String?
  processedAt      DateTime?
  approvedBy       String?
  approvedAt       DateTime?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  items            PayrollItem[]
  organization     Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  transaction      Transaction?  @relation(fields: [transactionId], references: [id])

  @@unique([organizationId, payrollNumber])
  @@index([organizationId, status])
  @@index([payPeriodStart, payPeriodEnd])
}

model PayrollItem {
  id                String     @id @default(cuid())
  payrollRunId      String
  employeeId        String
  grossPay          Decimal    @default(0) @db.Decimal(19, 4)
  basicSalary       Decimal    @default(0) @db.Decimal(19, 4)
  allowances        Decimal    @default(0) @db.Decimal(19, 4)
  bonuses           Decimal    @default(0) @db.Decimal(19, 4)
  overtime          Decimal    @default(0) @db.Decimal(19, 4)
  totalDeductions   Decimal    @default(0) @db.Decimal(19, 4)
  taxDeduction      Decimal    @default(0) @db.Decimal(19, 4)
  socialSecurity    Decimal    @default(0) @db.Decimal(19, 4)
  benefitDeductions Decimal    @default(0) @db.Decimal(19, 4)
  otherDeductions   Decimal    @default(0) @db.Decimal(19, 4)
  netPay            Decimal    @default(0) @db.Decimal(19, 4)
  employerTaxes     Decimal    @default(0) @db.Decimal(19, 4)
  notes             String?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  employee          Employee   @relation(fields: [employeeId], references: [id])
  payrollRun        PayrollRun @relation(fields: [payrollRunId], references: [id], onDelete: Cascade)

  @@unique([payrollRunId, employeeId])
  @@index([payrollRunId])
  @@index([employeeId])
}

model Benefit {
  id             String              @id @default(cuid())
  organizationId String
  code           String
  name           String
  description    String?
  benefitType    BenefitType
  employerCost   Decimal?            @db.Decimal(19, 4)
  employeeCost   Decimal?            @db.Decimal(19, 4)
  isActive       Boolean             @default(true)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  enrollments    BenefitEnrollment[]

  @@unique([organizationId, code])
  @@index([organizationId])
}

model BenefitEnrollment {
  id             String           @id @default(cuid())
  employeeId     String
  benefitId      String
  enrollmentDate DateTime
  effectiveDate  DateTime
  endDate        DateTime?
  employeeCost   Decimal          @default(0) @db.Decimal(19, 4)
  employerCost   Decimal          @default(0) @db.Decimal(19, 4)
  status         EnrollmentStatus @default(ACTIVE)
  notes          String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  benefit        Benefit          @relation(fields: [benefitId], references: [id])
  employee       Employee         @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([benefitId])
}

model LeaveType {
  id               String         @id @default(cuid())
  organizationId   String
  code             String
  name             String
  description      String?
  daysPerYear      Decimal?       @db.Decimal(8, 2)
  isPaid           Boolean        @default(true)
  requiresApproval Boolean        @default(true)
  isActive         Boolean        @default(true)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  leaveRequests    LeaveRequest[]
  organization     Organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
  @@index([organizationId])
}

model LeaveRequest {
  id              String      @id @default(cuid())
  employeeId      String
  leaveTypeId     String
  startDate       DateTime
  endDate         DateTime
  daysRequested   Decimal     @db.Decimal(8, 2)
  reason          String?
  status          LeaveStatus @default(PENDING)
  approvedBy      String?
  approvedAt      DateTime?
  rejectionReason String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  approver        User?       @relation(fields: [approvedBy], references: [id])
  employee        Employee    @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  leaveType       LeaveType   @relation(fields: [leaveTypeId], references: [id])

  @@index([employeeId])
  @@index([leaveTypeId])
  @@index([status])
}

model TimeEntry {
  id              String          @id @default(cuid())
  employeeId      String
  entryDate       DateTime
  hoursWorked     Decimal         @db.Decimal(8, 2)
  overtimeHours   Decimal         @default(0) @db.Decimal(8, 2)
  projectId       String?
  taskDescription String?
  status          TimeEntryStatus @default(SUBMITTED)
  approvedBy      String?
  approvedAt      DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  approver        User?           @relation(fields: [approvedBy], references: [id])
  employee        Employee        @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  project         Project?        @relation(fields: [projectId], references: [id])

  @@index([employeeId])
  @@index([projectId])
  @@index([entryDate])
}

model ExpenseClaim {
  id            String             @id @default(cuid())
  employeeId    String
  claimNumber   String
  claimDate     DateTime
  totalAmount   Decimal            @default(0) @db.Decimal(19, 4)
  currency      String             @default("USD")
  status        ExpenseClaimStatus @default(DRAFT)
  purpose       String?
  notes         String?
  approvedBy    String?
  approvedAt    DateTime?
  paidBy        String?
  paidAt        DateTime?
  transactionId String?            @unique
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  approver      User?              @relation("ExpenseApprover", fields: [approvedBy], references: [id])
  employee      Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  payer         User?              @relation("ExpensePayer", fields: [paidBy], references: [id])
  transaction   Transaction?       @relation(fields: [transactionId], references: [id])
  items         ExpenseItem[]

  @@unique([employeeId, claimNumber])
  @@index([employeeId])
  @@index([status])
}

model ExpenseItem {
  id             String       @id @default(cuid())
  expenseClaimId String
  expenseDate    DateTime
  category       String
  description    String
  amount         Decimal      @db.Decimal(19, 4)
  receiptUrl     String?
  notes          String?
  createdAt      DateTime     @default(now())
  expenseClaim   ExpenseClaim @relation(fields: [expenseClaimId], references: [id], onDelete: Cascade)

  @@index([expenseClaimId])
}

model PerformanceReview {
  id                  String       @id @default(cuid())
  employeeId          String
  reviewCycleId       String?
  reviewerId          String?
  reviewDate          DateTime
  reviewPeriodStart   DateTime?
  reviewPeriodEnd     DateTime?
  overallRating       Decimal?     @db.Decimal(3, 2)
  strengths           String?
  areasForImprovement String?
  goals               String?
  comments            String?
  status              ReviewStatus @default(DRAFT)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  employee            Employee     @relation("EmployeeReviews", fields: [employeeId], references: [id], onDelete: Cascade)
  reviewCycle         ReviewCycle? @relation(fields: [reviewCycleId], references: [id])
  reviewer            Employee?    @relation("ReviewerReviews", fields: [reviewerId], references: [id])

  @@index([employeeId])
  @@index([reviewerId])
  @@index([reviewCycleId])
}

model ReviewCycle {
  id             String              @id @default(cuid())
  organizationId String
  name           String
  startDate      DateTime
  endDate        DateTime
  status         String              @default("ACTIVE")
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  reviews        PerformanceReview[]
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model ServiceWorkOrder {
  id              String             @id @default(cuid())
  organizationId  String
  workOrderNumber String
  customerId      String?
  contactName     String?
  contactPhone    String?
  serviceLocation String?
  priority        ServicePriority    @default(MEDIUM)
  status          ServiceOrderStatus @default(SCHEDULED)
  scheduledStart  DateTime?
  scheduledEnd    DateTime?
  actualStart     DateTime?
  actualEnd       DateTime?
  technicianId    String?
  description     String?
  resolution      String?
  laborHours      Decimal?           @db.Decimal(8, 2)
  laborCost       Decimal?           @db.Decimal(19, 4)
  partsCost       Decimal?           @db.Decimal(19, 4)
  totalCost       Decimal?           @db.Decimal(19, 4)
  invoiceId       String?
  slaId           String?
  slaCompliant    Boolean?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  customer        Customer?          @relation(fields: [customerId], references: [id])
  invoice         Invoice?           @relation(fields: [invoiceId], references: [id])
  organization    Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  sla             ServiceSLA?        @relation(fields: [slaId], references: [id])
  technician      ServiceTechnician? @relation(fields: [technicianId], references: [id])

  @@unique([organizationId, workOrderNumber])
  @@index([organizationId, status])
  @@index([technicianId])
  @@index([customerId])
}

model ServiceTechnician {
  id                    String                 @id @default(cuid())
  organizationId        String
  employeeId            String?                @unique
  name                  String
  email                 String?
  phone                 String?
  skills                String[]
  availability          String                 @default("AVAILABLE")
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  maintenanceWorkOrders MaintenanceWorkOrder[]
  employee              Employee?              @relation(fields: [employeeId], references: [id])
  organization          Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  serviceWorkOrders     ServiceWorkOrder[]

  @@index([organizationId])
}

model ServiceSLA {
  id             String             @id @default(cuid())
  organizationId String
  name           String
  description    String?
  responseTime   Int
  resolutionTime Int
  priority       ServicePriority
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  organization   Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  workOrders     ServiceWorkOrder[]

  @@index([organizationId])
}

model ServiceCatalog {
  id                    String                @id @default(cuid())
  organizationId        String
  serviceCode           String
  name                  String
  description           String?
  serviceType           ServiceType           @default(PROFESSIONAL)
  category              String?
  pricingModel          ServicePricingModel   @default(FIXED_PRICE)
  unitOfMeasure         String?               // hour, project, user, etc.
  standardRate          Decimal?              @db.Decimal(19, 4)
  standardDuration      Int?                  // in minutes
  skillLevel            ServiceSkillLevel     @default(STANDARD)
  department            String?
  isActive              Boolean               @default(true)
  isBillable            Boolean               @default(true)
  isInternal            Boolean               @default(false)
  requiresApproval      Boolean               @default(false)
  autoScheduling        Boolean               @default(false)
  allowOnlineBooking    Boolean               @default(false)
  minimumBookingHours   Int?                  @default(1)
  maximumBookingHours   Int?
  advanceBookingHours   Int?                  @default(24)
  cancellationHours     Int?                  @default(24)
  serviceUrl            String?
  serviceIcon           String?
  tags                  String[]              @default([])
  metadata              Json?                 // Additional flexible fields
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  organization          Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  activities            ServiceActivity[]
  offerings             ServiceOffering[]
  deliveries            ServiceDelivery[]
  bookings              ServiceBooking[]
  resources             ServiceResource[]
  invoiceItems          InvoiceItem[]
  billItems             BillItem[]

  @@unique([organizationId, serviceCode])
  @@index([organizationId, serviceType])
  @@index([organizationId, category])
  @@index([organizationId, isActive])
}

model ServiceActivity {
  id               String                @id @default(cuid())
  organizationId   String
  serviceCatalogId String
  activityCode     String
  name             String
  description      String?
  sequence         Int                   @default(1)
  estimatedHours   Decimal?              @db.Decimal(8, 2)
  standardRate     Decimal?              @db.Decimal(19, 4)
  skillRequired    ServiceSkillLevel     @default(STANDARD)
  isOptional       Boolean               @default(false)
  isMilestone      Boolean               @default(false)
  dependencies     String[]              @default([]) // Activity codes that must complete first
  deliverables     String[]              @default([])
  qualityChecks    String[]              @default([])
  isActive         Boolean               @default(true)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  organization     Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  serviceCatalog   ServiceCatalog        @relation(fields: [serviceCatalogId], references: [id], onDelete: Cascade)
  activityEntries  ServiceActivityEntry[]

  @@unique([organizationId, serviceCatalogId, activityCode])
  @@index([serviceCatalogId])
}

model ServiceOffering {
  id                    String                @id @default(cuid())
  organizationId        String
  serviceCatalogId      String
  offeringCode          String
  name                  String
  description           String?
  packagePrice          Decimal               @db.Decimal(19, 4)
  packageDuration       Int                   // total hours/days
  validityDays          Int                   @default(365)
  maxParticipants       Int?
  location              ServiceLocation       @default(CLIENT_SITE)
  deliveryMethod        ServiceDeliveryMethod @default(ON_SITE)
  prerequisites         String[]              @default([])
  includedActivities    String[]              @default([]) // Activity codes
  materials             String[]              @default([])
  deliverables          String[]              @default([])
  supportPeriodDays     Int?                  @default(30)
  warrantyPeriodDays    Int?
  isActive              Boolean               @default(true)
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  organization          Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  serviceCatalog        ServiceCatalog        @relation(fields: [serviceCatalogId], references: [id], onDelete: Cascade)
  bookings              ServiceBooking[]

  @@unique([organizationId, serviceCatalogId, offeringCode])
  @@index([serviceCatalogId])
}

model ServiceDelivery {
  id                 String                @id @default(cuid())
  organizationId     String
  serviceCatalogId   String
  deliveryNumber     String
  customerId         String?
  projectId          String?
  bookingId          String?
  status             ServiceDeliveryStatus @default(PLANNED)
  priority           ServicePriority       @default(MEDIUM)
  plannedStartDate   DateTime
  plannedEndDate     DateTime
  actualStartDate    DateTime?
  actualEndDate      DateTime?
  assignedTo         String[]              @default([]) // User IDs
  location           String?
  clientContactName  String?
  clientContactEmail String?
  clientContactPhone String?
  estimatedHours     Decimal               @db.Decimal(8, 2)
  actualHours        Decimal?              @db.Decimal(8, 2)
  progress           Int                   @default(0) // 0-100 percentage
  qualityScore       Int?                  // 1-5 rating
  customerSatisfaction Int?                // 1-5 rating
  notes              String?
  deliverables       String[]              @default([])
  completionCriteria String[]              @default([])
  signOffRequired    Boolean               @default(false)
  signOffBy          String?               // User ID
  signOffDate        DateTime?
  invoiceId          String?
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  organization       Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  serviceCatalog     ServiceCatalog        @relation(fields: [serviceCatalogId], references: [id])
  customer           Customer?             @relation(fields: [customerId], references: [id])
  booking            ServiceBooking?       @relation(fields: [bookingId], references: [id])
  activityEntries    ServiceActivityEntry[]
  timeEntries        ServiceTimeEntry[]

  @@unique([organizationId, deliveryNumber])
  @@index([organizationId, status])
  @@index([serviceCatalogId])
  @@index([customerId])
}

model ServiceBooking {
  id                String               @id @default(cuid())
  organizationId    String
  serviceCatalogId  String?
  offeringId        String?
  bookingNumber     String
  customerId        String
  contactName       String?
  contactEmail      String?
  contactPhone      String?
  bookingDate       DateTime             @default(now())
  requestedDate     DateTime
  confirmedDate     DateTime?
  status            ServiceBookingStatus @default(REQUESTED)
  priority          ServicePriority      @default(MEDIUM)
  location          String?
  specialRequests   String?
  estimatedHours    Decimal?             @db.Decimal(8, 2)
  quotedPrice       Decimal?             @db.Decimal(19, 4)
  approvedPrice     Decimal?             @db.Decimal(19, 4)
  approvedBy        String?              // User ID
  approvedDate      DateTime?
  cancellationReason String?
  cancellationDate  DateTime?
  paymentTerms      String?
  paymentStatus     PaymentStatus?       @default(UNPAID)
  notes             String?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  organization      Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  customer          Customer             @relation(fields: [customerId], references: [id])
  serviceCatalog    ServiceCatalog?      @relation(fields: [serviceCatalogId], references: [id])
  offering          ServiceOffering?     @relation(fields: [offeringId], references: [id])
  deliveries        ServiceDelivery[]

  @@unique([organizationId, bookingNumber])
  @@index([organizationId, status])
  @@index([customerId])
  @@index([serviceCatalogId])
}

model ServiceActivityEntry {
  id                String           @id @default(cuid())
  organizationId    String
  deliveryId        String
  activityId        String
  entryDate         DateTime         @default(now())
  startTime         DateTime
  endTime           DateTime?
  durationMinutes   Int?
  assignedTo        String           // User ID
  status            ActivityStatus   @default(NOT_STARTED)
  progress          Int              @default(0) // 0-100 percentage
  qualityCheck      Boolean          @default(false)
  qualityNotes      String?
  blockers          String[]         @default([])
  completionNotes   String?
  deliverables      String[]         @default([])
  clientPresent     Boolean          @default(false)
  clientFeedback    String?
  billableHours     Decimal?         @db.Decimal(8, 2)
  billableRate      Decimal?         @db.Decimal(19, 4)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  organization      Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  delivery          ServiceDelivery  @relation(fields: [deliveryId], references: [id], onDelete: Cascade)
  activity          ServiceActivity  @relation(fields: [activityId], references: [id])

  @@index([organizationId, deliveryId])
  @@index([activityId])
  @@index([assignedTo])
}

model ServiceTimeEntry {
  id             String          @id @default(cuid())
  organizationId String
  deliveryId     String
  userId         String          // Who performed the work
  entryDate      DateTime        @default(now())
  startTime      DateTime
  endTime        DateTime?
  durationHours  Decimal         @db.Decimal(8, 2)
  description    String
  workType       ServiceWorkType @default(DELIVERY)
  isBillable     Boolean         @default(true)
  hourlyRate     Decimal?        @db.Decimal(19, 4)
  totalAmount    Decimal?        @db.Decimal(19, 4)
  approvedBy     String?         // User ID
  approvedDate   DateTime?
  invoiced       Boolean         @default(false)
  invoiceId      String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  delivery       ServiceDelivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade)
  user           User            @relation(fields: [userId], references: [id])

  @@index([organizationId, deliveryId])
  @@index([userId])
  @@index([entryDate])
}

model ServiceResource {
  id               String              @id @default(cuid())
  organizationId   String
  serviceCatalogId String
  resourceType     ServiceResourceType @default(HUMAN)
  resourceId       String              // User ID, Equipment ID, etc.
  resourceName     String
  availability     ResourceAvailability @default(AVAILABLE)
  hourlyRate       Decimal?            @db.Decimal(19, 4)
  utilizationTarget Int                @default(80) // Target utilization percentage
  skills           String[]            @default([])
  certifications   String[]            @default([])
  isActive         Boolean             @default(true)
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  organization     Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  serviceCatalog   ServiceCatalog      @relation(fields: [serviceCatalogId], references: [id], onDelete: Cascade)

  @@unique([organizationId, serviceCatalogId, resourceId])
  @@index([serviceCatalogId])
  @@index([resourceType])
  @@index([availability])
}

model MaintenancePlan {
  id             String                 @id @default(cuid())
  organizationId String
  planNumber     String
  name           String
  description    String?
  assetId        String?
  planType       MaintenanceType        @default(PREVENTIVE)
  frequency      String?
  frequencyValue Int?
  usageTrigger   Decimal?               @db.Decimal(12, 2)
  usageUnit      String?
  nextDueDate    DateTime?
  isActive       Boolean                @default(true)
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  asset          Asset?                 @relation(fields: [assetId], references: [id])
  organization   Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  workOrders     MaintenanceWorkOrder[]

  @@unique([organizationId, planNumber])
  @@index([organizationId])
  @@index([assetId])
}

model MaintenanceWorkOrder {
  id                String             @id @default(cuid())
  organizationId    String
  workOrderNumber   String
  maintenancePlanId String?
  assetId           String?
  maintenanceType   MaintenanceType
  priority          ServicePriority    @default(MEDIUM)
  status            MaintenanceStatus  @default(SCHEDULED)
  scheduledDate     DateTime?
  completedDate     DateTime?
  technicianId      String?
  description       String
  resolution        String?
  laborHours        Decimal?           @db.Decimal(8, 2)
  laborCost         Decimal?           @db.Decimal(19, 4)
  partsCost         Decimal?           @db.Decimal(19, 4)
  totalCost         Decimal?           @db.Decimal(19, 4)
  downtimeHours     Decimal?           @db.Decimal(8, 2)
  notes             String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  asset             Asset?             @relation(fields: [assetId], references: [id])
  maintenancePlan   MaintenancePlan?   @relation(fields: [maintenancePlanId], references: [id])
  organization      Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  technician        ServiceTechnician? @relation(fields: [technicianId], references: [id])
  spareParts        SparePartUsage[]

  @@unique([organizationId, workOrderNumber])
  @@index([organizationId, status])
  @@index([assetId])
  @@index([maintenancePlanId])
}

model SparePart {
  id             String           @id @default(cuid())
  organizationId String
  partNumber     String
  name           String
  description    String?
  productId      String?
  minimumStock   Decimal?         @db.Decimal(12, 4)
  quantityOnHand Decimal          @default(0) @db.Decimal(12, 4)
  unitCost       Decimal?         @db.Decimal(19, 4)
  location       String?
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product        Product?         @relation(fields: [productId], references: [id])
  usage          SparePartUsage[]

  @@unique([organizationId, partNumber])
  @@index([organizationId])
  @@index([productId])
}

model SparePartUsage {
  id           String               @id @default(cuid())
  workOrderId  String
  sparePartId  String
  quantityUsed Decimal              @db.Decimal(12, 4)
  unitCost     Decimal              @db.Decimal(19, 4)
  totalCost    Decimal              @db.Decimal(19, 4)
  createdAt    DateTime             @default(now())
  sparePart    SparePart            @relation(fields: [sparePartId], references: [id])
  workOrder    MaintenanceWorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@index([workOrderId])
  @@index([sparePartId])
}

model Report {
  id             String            @id @default(cuid())
  organizationId String
  name           String
  description    String?
  reportType     ReportType
  category       String?
  query          Json
  columns        Json
  filters        Json?
  sorting        Json?
  grouping       Json?
  aggregations   Json?
  chartConfig    Json?
  isPublic       Boolean           @default(false)
  createdById    String
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  dashboards     DashboardWidget[]
  createdBy      User              @relation(fields: [createdById], references: [id])
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  schedules      ReportSchedule[]

  @@index([organizationId])
  @@index([reportType])
  @@index([category])
}

model Dashboard {
  id             String            @id @default(cuid())
  organizationId String
  name           String
  description    String?
  layout         Json
  isDefault      Boolean           @default(false)
  isPublic       Boolean           @default(false)
  createdById    String
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  createdBy      User              @relation(fields: [createdById], references: [id])
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  widgets        DashboardWidget[]

  @@index([organizationId])
}

model DashboardWidget {
  id              String    @id @default(cuid())
  dashboardId     String
  reportId        String?
  widgetType      String
  title           String
  position        Json
  config          Json
  refreshInterval Int?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  dashboard       Dashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade)
  report          Report?   @relation(fields: [reportId], references: [id])

  @@index([dashboardId])
}

model ReportSchedule {
  id             String              @id @default(cuid())
  organizationId String
  reportId       String
  name           String
  frequency      ScheduleFrequency
  cronExpression String?
  recipients     Json
  format         ReportFormat        @default(PDF)
  filters        Json?
  isActive       Boolean             @default(true)
  lastRun        DateTime?
  nextRun        DateTime?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  report         Report              @relation(fields: [reportId], references: [id], onDelete: Cascade)
  executions     ScheduleExecution[]

  @@index([organizationId])
  @@index([nextRun])
}

model ScheduleExecution {
  id           String                  @id @default(cuid())
  scheduleId   String
  status       ScheduleExecutionStatus
  startedAt    DateTime                @default(now())
  completedAt  DateTime?
  fileUrl      String?
  errorMessage String?
  schedule     ReportSchedule          @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId])
}

model DataCube {
  id              String       @id @default(cuid())
  organizationId  String
  name            String
  description     String?
  sourceType      String
  dimensions      Json
  measures        Json
  query           Json
  aggregationRule Json
  isActive        Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model ApprovalWorkflow {
  id             String             @id @default(cuid())
  organizationId String
  name           String
  description    String?
  entityType     ApprovalEntityType
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  requests       ApprovalRequest[]
  rules          ApprovalRule[]
  steps          ApprovalStep[]
  organization   Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, entityType])
}

model ApprovalStep {
  id              String           @id @default(cuid())
  workflowId      String
  stepOrder       Int
  name            String
  description     String?
  approverType    ApproverType
  approverIds     Json?
  approverRoles   Json?
  requireAll      Boolean          @default(false)
  escalationHours Int?
  escalationTo    Json?
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  actions         ApprovalAction[]
  workflow        ApprovalWorkflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([workflowId, stepOrder])
}

model ApprovalRule {
  id          String           @id @default(cuid())
  workflowId  String
  name        String
  description String?
  conditions  Json
  isActive    Boolean          @default(true)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  workflow    ApprovalWorkflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([workflowId])
}

model ApprovalRequest {
  id               String             @id @default(cuid())
  organizationId   String
  workflowId       String
  entityType       ApprovalEntityType
  entityId         String
  requestedById    String
  currentStepOrder Int                @default(1)
  status           ApprovalStatus     @default(PENDING)
  priority         ApprovalPriority   @default(NORMAL)
  metadata         Json?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  actions          ApprovalAction[]
  organization     Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  requestedBy      User               @relation("RequestedApprovals", fields: [requestedById], references: [id])
  workflow         ApprovalWorkflow   @relation(fields: [workflowId], references: [id])

  @@index([organizationId, status])
  @@index([entityType, entityId])
}

model ApprovalAction {
  id          String             @id @default(cuid())
  requestId   String
  stepId      String
  approverId  String
  action      ApprovalActionType
  delegatedTo String?
  comment     String?
  createdAt   DateTime           @default(now())
  approver    User               @relation("ApprovalActions", fields: [approverId], references: [id])
  delegateTo  User?              @relation("DelegatedApprovals", fields: [delegatedTo], references: [id])
  request     ApprovalRequest    @relation(fields: [requestId], references: [id], onDelete: Cascade)
  step        ApprovalStep       @relation(fields: [stepId], references: [id])

  @@index([requestId])
  @@index([approverId])
}

model WebhookEndpoint {
  id             String            @id @default(cuid())
  organizationId String
  url            String
  events         Json
  secret         String
  isActive       Boolean           @default(true)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  deliveries     WebhookDelivery[]
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model WebhookDelivery {
  id             String          @id @default(cuid())
  endpointId     String
  eventType      String
  payload        Json
  responseStatus Int?
  responseBody   String?
  attempts       Int             @default(0)
  nextRetry      DateTime?
  deliveredAt    DateTime?
  createdAt      DateTime        @default(now())
  endpoint       WebhookEndpoint @relation(fields: [endpointId], references: [id], onDelete: Cascade)

  @@index([endpointId])
  @@index([nextRetry])
}

model EventLog {
  id             String       @id @default(cuid())
  organizationId String
  integrationId  String?
  eventType      String
  source         String
  entityType     String?
  entityId       String?
  payload        Json
  status         EventStatus
  errorMessage   String?
  createdAt      DateTime     @default(now())
  integration    Integration? @relation(fields: [integrationId], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, eventType])
  @@index([createdAt])
}

model EInvoiceConfig {
  id              String       @id @default(cuid())
  organizationId  String       @unique
  country         String
  provider        String
  apiEndpoint     String
  credentials     Json
  certificatePath String?
  isActive        Boolean      @default(true)
  lastSyncAt      DateTime?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
}

model RowLevelSecurityRule {
  id             String       @id @default(cuid())
  organizationId String
  name           String
  description    String?
  entityType     String
  roleId         String?
  userId         String?
  conditions     Json
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, entityType])
}

model SSOConfig {
  id               String       @id @default(cuid())
  organizationId   String       @unique
  provider         String
  issuer           String
  entryPoint       String
  certificate      String
  identifierFormat String?
  isActive         Boolean      @default(true)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  organization     Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
}

model MFASettings {
  id          String    @id @default(cuid())
  userId      String    @unique
  method      MFAMethod
  secret      String?
  phoneNumber String?
  backupCodes Json?
  isEnabled   Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ItemMaster {
  id             String              @id @default(cuid())
  organizationId String
  masterNumber   String
  name           String
  description    String?
  category       String?
  productId      String?             @unique
  attributeSetId String?
  status         MasterDataStatus    @default(ACTIVE)
  version        Int                 @default(1)
  createdById    String
  approvedById   String?
  approvedAt     DateTime?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  approvedBy     User?               @relation("ApprovedItemMasters", fields: [approvedById], references: [id])
  attributeSet   AttributeSet?       @relation(fields: [attributeSetId], references: [id])
  createdBy      User                @relation("CreatedItemMasters", fields: [createdById], references: [id])
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product        Product?            @relation(fields: [productId], references: [id])
  versions       MasterDataVersion[]
  variants       ProductVariant[]

  @@unique([organizationId, masterNumber])
  @@index([organizationId, status])
}

model MasterDataVersion {
  id           String     @id @default(cuid())
  itemMasterId String
  version      Int
  changes      Json
  changeReason String?
  changedById  String
  createdAt    DateTime   @default(now())
  changedBy    User       @relation(fields: [changedById], references: [id])
  itemMaster   ItemMaster @relation(fields: [itemMasterId], references: [id], onDelete: Cascade)

  @@index([itemMasterId])
}

model AttributeSet {
  id             String           @id @default(cuid())
  organizationId String
  name           String
  description    String?
  attributes     Json
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  itemMasters    ItemMaster[]
  variants       ProductVariant[]

  @@index([organizationId])
}

model ProductVariant {
  id              String        @id @default(cuid())
  itemMasterId    String
  productId       String        @unique
  sku             String
  attributeSetId  String?
  attributeValues Json
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  attributeSet    AttributeSet? @relation(fields: [attributeSetId], references: [id])
  itemMaster      ItemMaster    @relation(fields: [itemMasterId], references: [id], onDelete: Cascade)
  product         Product       @relation(fields: [productId], references: [id])

  @@unique([itemMasterId, sku])
  @@index([itemMasterId])
}

model PriceList {
  id             String          @id @default(cuid())
  organizationId String
  name           String
  description    String?
  currency       String          @default("USD")
  isDefault      Boolean         @default(false)
  validFrom      DateTime?
  validTo        DateTime?
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  prices         PriceListItem[]

  @@index([organizationId])
}

model PriceListItem {
  id          String    @id @default(cuid())
  priceListId String
  productId   String
  price       Decimal   @db.Decimal(19, 4)
  minQuantity Decimal?  @db.Decimal(12, 4)
  maxQuantity Decimal?  @db.Decimal(12, 4)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  priceList   PriceList @relation(fields: [priceListId], references: [id], onDelete: Cascade)
  product     Product   @relation(fields: [productId], references: [id])

  @@unique([priceListId, productId, minQuantity])
  @@index([priceListId])
  @@index([productId])
}

model Discount {
  id             String       @id @default(cuid())
  organizationId String
  code           String
  name           String
  description    String?
  discountType   DiscountType
  value          Decimal      @db.Decimal(19, 4)
  minPurchase    Decimal?     @db.Decimal(19, 4)
  maxDiscount    Decimal?     @db.Decimal(19, 4)
  validFrom      DateTime
  validTo        DateTime
  usageLimit     Int?
  usageCount     Int          @default(0)
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
  @@index([organizationId])
  @@index([validFrom, validTo])
}

model Promotion {
  id             String        @id @default(cuid())
  organizationId String
  name           String
  description    String?
  promotionType  PromotionType
  rules          Json
  discountType   DiscountType
  discountValue  Decimal       @db.Decimal(19, 4)
  validFrom      DateTime
  validTo        DateTime
  priority       Int           @default(0)
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organization   Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([validFrom, validTo])
}

model CycleCount {
  id             String              @id @default(cuid())
  organizationId String
  countNumber    String
  warehouseId    String?
  status         CycleCountStatus    @default(PLANNED)
  scheduledDate  DateTime
  countedDate    DateTime?
  assignedToId   String?
  notes          String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  assignedTo     User?               @relation(fields: [assignedToId], references: [id])
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  warehouse      InventoryWarehouse? @relation(fields: [warehouseId], references: [id])
  items          CycleCountItem[]

  @@unique([organizationId, countNumber])
  @@index([organizationId, status])
}

model CycleCountItem {
  id            String     @id @default(cuid())
  cycleCountId  String
  productId     String
  expectedQty   Decimal    @db.Decimal(12, 4)
  countedQty    Decimal?   @db.Decimal(12, 4)
  variance      Decimal?   @db.Decimal(12, 4)
  varianceValue Decimal?   @db.Decimal(19, 4)
  notes         String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  cycleCount    CycleCount @relation(fields: [cycleCountId], references: [id], onDelete: Cascade)
  product       Product    @relation(fields: [productId], references: [id])

  @@index([cycleCountId])
}

model InventoryValuation {
  id             String              @id @default(cuid())
  organizationId String
  productId      String
  warehouseId    String?
  valuationDate  DateTime
  method         ValuationMethod
  quantity       Decimal             @db.Decimal(12, 4)
  unitCost       Decimal             @db.Decimal(19, 4)
  totalValue     Decimal             @db.Decimal(19, 4)
  createdAt      DateTime            @default(now())
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product        Product             @relation(fields: [productId], references: [id])
  warehouse      InventoryWarehouse? @relation(fields: [warehouseId], references: [id])

  @@index([organizationId, valuationDate])
  @@index([productId])
}

model StockReservation {
  id              String              @id @default(cuid())
  organizationId  String
  productId       String
  warehouseId     String?
  quantity        Decimal             @db.Decimal(12, 4)
  reservationType String
  referenceId     String?
  reservedUntil   DateTime?
  status          ReservationStatus   @default(ACTIVE)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  organization    Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product         Product             @relation(fields: [productId], references: [id])
  warehouse       InventoryWarehouse? @relation(fields: [warehouseId], references: [id])

  @@index([organizationId, status])
  @@index([productId])
}

model StandardCost {
  id                String         @id @default(cuid())
  organizationId    String
  productId         String
  costingMethod     CostingMethod  @default(WEIGHTED_AVERAGE)
  
  // Cost components in organization base currency
  materialCost      Decimal        @db.Decimal(19, 4)
  laborCost         Decimal        @db.Decimal(19, 4)
  overheadCost      Decimal        @db.Decimal(19, 4)
  totalStandardCost Decimal        @db.Decimal(19, 4)
  
  // Enhanced versioning and control
  costingVersion    String         @default("1.0")
  status            StandardCostStatus @default(DRAFT)
  effectiveFrom     DateTime
  effectiveTo       DateTime?
  validFrom         DateTime       @default(now())
  validTo           DateTime?
  isActive          Boolean        @default(true)
  isFrozen          Boolean        @default(false)
  
  // Approval workflow
  approvalRequired  Boolean        @default(false)
  approvedBy        String?
  approvedAt        DateTime?
  rejectedBy        String?
  rejectedAt        DateTime?
  rejectionReason   String?
  
  // Localization support
  baseCurrency      String         @default("USD")
  localizedCosts    Json?          // For storing region-specific cost adjustments
  
  // Variance tracking
  lastPurchasePrice Decimal?       @db.Decimal(19, 4)
  priceDelta        Decimal?       @db.Decimal(19, 4)
  priceVariance     Decimal?       @db.Decimal(19, 4)
  
  // BOM roll-up tracking
  bomId             String?
  routingId         String?
  lastRollupDate    DateTime?
  rollupSource      String?        // 'MANUAL' | 'BOM_ROLLUP' | 'IMPORT'
  
  notes             String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  // Relations
  variances         CostVariance[]
  organization      Organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product           Product        @relation(fields: [productId], references: [id])
  bom               BillOfMaterial? @relation(fields: [bomId], references: [id])
  routing           Routing?       @relation(fields: [routingId], references: [id])

  @@index([organizationId, productId])
  @@index([effectiveFrom, effectiveTo])
  @@index([costingVersion, status])
  @@index([status, approvalRequired])
  @@unique([organizationId, productId, costingVersion])
}

model CostVariance {
  id               String        @id @default(cuid())
  organizationId   String
  productId        String
  standardCostId   String?
  transactionId    String?
  varianceType     VarianceType
  materialVariance Decimal?      @db.Decimal(19, 4)
  laborVariance    Decimal?      @db.Decimal(19, 4)
  overheadVariance Decimal?      @db.Decimal(19, 4)
  totalVariance    Decimal       @db.Decimal(19, 4)
  quantity         Decimal       @db.Decimal(12, 4)
  referenceType    String?
  referenceId      String?
  notes            String?
  createdAt        DateTime      @default(now())
  organization     Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product          Product       @relation(fields: [productId], references: [id])
  standardCost     StandardCost? @relation(fields: [standardCostId], references: [id])
  transaction      Transaction?  @relation(fields: [transactionId], references: [id])

  @@index([organizationId, productId])
  @@index([varianceType])
  @@index([createdAt])
}

model LandedCost {
  id               String                     @id @default(cuid())
  organizationId   String
  referenceType    String
  referenceId      String
  totalProductCost Decimal                    @db.Decimal(19, 4)
  freightCost      Decimal                    @default(0) @db.Decimal(19, 4)
  insuranceCost    Decimal                    @default(0) @db.Decimal(19, 4)
  customsDuty      Decimal                    @default(0) @db.Decimal(19, 4)
  handlingCost     Decimal                    @default(0) @db.Decimal(19, 4)
  otherCosts       Decimal                    @default(0) @db.Decimal(19, 4)
  totalLandedCost  Decimal                    @db.Decimal(19, 4)
  allocationMethod LandedCostAllocation       @default(BY_VALUE)
  isAllocated      Boolean                    @default(false)
  allocatedAt      DateTime?
  notes            String?
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime                   @updatedAt
  organization     Organization               @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  allocations      LandedCostAllocationItem[]

  @@index([organizationId, referenceType, referenceId])
}

model LandedCostAllocationItem {
  id              String     @id @default(cuid())
  landedCostId    String
  productId       String
  quantity        Decimal    @db.Decimal(12, 4)
  productCost     Decimal    @db.Decimal(19, 4)
  allocatedAmount Decimal    @db.Decimal(19, 4)
  unitLandedCost  Decimal    @db.Decimal(19, 4)
  createdAt       DateTime   @default(now())
  landedCost      LandedCost @relation(fields: [landedCostId], references: [id], onDelete: Cascade)
  product         Product    @relation(fields: [productId], references: [id])

  @@index([landedCostId])
  @@index([productId])
}

model CostRevaluation {
  id                String              @id @default(cuid())
  organizationId    String
  revaluationNumber String
  productId         String?
  warehouseId       String?
  revaluationDate   DateTime
  reason            String
  oldUnitCost       Decimal             @db.Decimal(19, 4)
  newUnitCost       Decimal             @db.Decimal(19, 4)
  quantity          Decimal             @db.Decimal(12, 4)
  valueDifference   Decimal             @db.Decimal(19, 4)
  transactionId     String?             @unique
  status            RevaluationStatus   @default(DRAFT)
  approvedById      String?
  approvedAt        DateTime?
  notes             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  approvedBy        User?               @relation(fields: [approvedById], references: [id])
  organization      Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product           Product?            @relation(fields: [productId], references: [id])
  transaction       Transaction?        @relation(fields: [transactionId], references: [id])
  warehouse         InventoryWarehouse? @relation(fields: [warehouseId], references: [id])

  @@unique([organizationId, revaluationNumber])
  @@index([organizationId, status])
  @@index([productId])
}

model DemandForecast {
  id               String              @id @default(cuid())
  organizationId   String
  productId        String
  warehouseId      String?
  forecastPeriod   String
  periodStart      DateTime
  periodEnd        DateTime
  forecastMethod   ForecastMethod      @default(MOVING_AVERAGE)
  forecastedDemand Decimal             @db.Decimal(12, 4)
  actualDemand     Decimal?            @db.Decimal(12, 4)
  accuracy         Decimal?            @db.Decimal(5, 2)
  confidenceLevel  Decimal?            @db.Decimal(5, 2)
  notes            String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  organization     Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product          Product             @relation(fields: [productId], references: [id])
  warehouse        InventoryWarehouse? @relation(fields: [warehouseId], references: [id])

  @@index([organizationId, productId])
  @@index([periodStart, periodEnd])
}

model SafetyStock {
  id                String              @id @default(cuid())
  organizationId    String
  productId         String
  warehouseId       String?
  safetyStockQty    Decimal             @db.Decimal(12, 4)
  calculationMethod SafetyStockMethod   @default(FIXED)
  leadTimeDays      Int?
  demandVariability Decimal?            @db.Decimal(5, 2)
  serviceLevel      Decimal?            @db.Decimal(5, 2)
  reviewPeriodDays  Int?
  isActive          Boolean             @default(true)
  effectiveFrom     DateTime
  effectiveTo       DateTime?
  notes             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  organization      Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product           Product             @relation(fields: [productId], references: [id])
  warehouse         InventoryWarehouse? @relation(fields: [warehouseId], references: [id])

  @@unique([organizationId, productId, warehouseId, effectiveFrom])
  @@index([organizationId, productId])
}

model ReorderPolicy {
  id              String              @id @default(cuid())
  organizationId  String
  productId       String
  warehouseId     String?
  policyType      ReorderPolicyType   @default(MIN_MAX)
  reorderPoint    Decimal             @db.Decimal(12, 4)
  reorderQuantity Decimal             @db.Decimal(12, 4)
  minQuantity     Decimal?            @db.Decimal(12, 4)
  maxQuantity     Decimal?            @db.Decimal(12, 4)
  leadTimeDays    Int
  reviewCycleDays Int?
  isActive        Boolean             @default(true)
  effectiveFrom   DateTime
  effectiveTo     DateTime?
  notes           String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  organization    Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product         Product             @relation(fields: [productId], references: [id])
  warehouse       InventoryWarehouse? @relation(fields: [warehouseId], references: [id])

  @@unique([organizationId, productId, warehouseId, effectiveFrom])
  @@index([organizationId, isActive])
}

model ProductPlanning {
  id                    String            @id @default(cuid())
  organizationId        String
  productId             String
  planningMethod        PlanningMethod    @default(MRP)
  abcClassification     ABCClass?
  criticalityLevel      CriticalityLevel? @default(NORMAL)
  isPurchased           Boolean           @default(true)
  isManufactured        Boolean           @default(false)
  defaultVendorId       String?
  procurementLeadTime   Int?
  manufacturingLeadTime Int?
  shelfLifeDays         Int?
  lotControl            Boolean           @default(false)
  serialControl         Boolean           @default(false)
  notes                 String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  vendor                Vendor?           @relation(fields: [defaultVendorId], references: [id])
  organization          Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product               Product           @relation(fields: [productId], references: [id])

  @@unique([organizationId, productId])
  @@index([organizationId, planningMethod])
}

model QualityInspection {
  id               String                 @id @default(cuid())
  organizationId   String
  inspectionNumber String
  inspectionType   InspectionType
  referenceType    String
  referenceId      String
  productId        String?
  lotNumber        String?
  quantity         Decimal                @db.Decimal(12, 4)
  inspectedQty     Decimal?               @db.Decimal(12, 4)
  acceptedQty      Decimal?               @db.Decimal(12, 4)
  rejectedQty      Decimal?               @db.Decimal(12, 4)
  status           InspectionStatus       @default(PENDING)
  inspectedById    String?
  inspectedAt      DateTime?
  dueDate          DateTime?
  priority         InspectionPriority     @default(NORMAL)
  notes            String?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  coa              CertificateOfAnalysis?
  holds            QualityHold[]
  inspectedBy      User?                  @relation(fields: [inspectedById], references: [id])
  organization     Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product          Product?               @relation(fields: [productId], references: [id])
  measurements     QualityMeasurement[]

  @@unique([organizationId, inspectionNumber])
  @@index([organizationId, status])
  @@index([referenceType, referenceId])
}

model QualityMeasurement {
  id            String            @id @default(cuid())
  inspectionId  String
  parameter     String
  specification String?
  measuredValue String
  uom           String?
  isCompliant   Boolean           @default(true)
  notes         String?
  createdAt     DateTime          @default(now())
  inspection    QualityInspection @relation(fields: [inspectionId], references: [id], onDelete: Cascade)

  @@index([inspectionId])
}

model QualityHold {
  id                String              @id @default(cuid())
  organizationId    String
  holdNumber        String
  inspectionId      String?
  productId         String
  lotNumber         String?
  batchNumber       String?
  serialNumber      String?
  quantity          Decimal             @db.Decimal(12, 4)
  warehouseId       String?
  holdType          HoldType            @default(QUALITY)
  holdReason        String
  status            HoldStatus          @default(ACTIVE)
  dispositionAction DispositionAction?
  dispositionNotes  String?
  releasedById      String?
  releasedAt        DateTime?
  createdById       String
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  metadata          Json?               // For UNBS case numbers, regulatory references
  attachments       Json?               // File attachments (COA, photos, etc.)
  inspection        QualityInspection?  @relation(fields: [inspectionId], references: [id])
  organization      Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product           Product             @relation(fields: [productId], references: [id])
  releasedBy        User?               @relation("QualityHoldReleasedBy", fields: [releasedById], references: [id])
  createdBy         User                @relation("QualityHoldCreatedBy", fields: [createdById], references: [id])
  warehouse         InventoryWarehouse? @relation(fields: [warehouseId], references: [id])

  @@unique([organizationId, holdNumber])
  @@index([organizationId, status])
  @@index([productId])
}

model CertificateOfAnalysis {
  id              String            @id @default(cuid())
  organizationId  String
  coaNumber       String
  inspectionId    String            @unique
  productId       String
  lotNumber       String
  batchNumber     String?
  manufactureDate DateTime?
  expiryDate      DateTime?
  testResults     Json
  conclusion      String
  issuedById      String
  issuedAt        DateTime
  notes           String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  inspection      QualityInspection @relation(fields: [inspectionId], references: [id])
  issuedBy        User              @relation(fields: [issuedById], references: [id])
  organization    Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product         Product           @relation(fields: [productId], references: [id])

  @@unique([organizationId, coaNumber])
  @@index([organizationId, productId])
  @@index([lotNumber])
}

model NonConformanceReport {
  id                String       @id @default(cuid())
  organizationId    String
  ncrNumber         String
  title             String
  description       String
  source            NCRSource
  severity          NCRSeverity  @default(MEDIUM)
  status            NCRStatus    @default(OPEN)
  productId         String?
  lotNumber         String?
  vendorId          String?
  customerId        String?
  quantity          Decimal?     @db.Decimal(12, 4)
  detectedDate      DateTime
  detectedById      String
  rootCause         String?
  containmentAction String?
  assignedToId      String?
  targetCloseDate   DateTime?
  closedAt          DateTime?
  closedById        String?
  notes             String?
  localComplianceData Json?      // Country-specific compliance data (UNBS, KEBS, etc.)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  capas             CAPA[]
  assignedTo        User?        @relation("NCRAssignedTo", fields: [assignedToId], references: [id])
  closedBy          User?        @relation("NCRClosedBy", fields: [closedById], references: [id])
  customer          Customer?    @relation(fields: [customerId], references: [id])
  detectedBy        User         @relation("NCRDetectedBy", fields: [detectedById], references: [id])
  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product           Product?     @relation(fields: [productId], references: [id])
  vendor            Vendor?      @relation(fields: [vendorId], references: [id])

  @@unique([organizationId, ncrNumber])
  @@index([organizationId, status])
  @@index([severity])
}

model CAPA {
  id                  String                @id @default(cuid())
  organizationId      String
  capaNumber          String
  ncrId               String?
  source              CAPASource            @default(NCR)
  riskLevel           CAPARiskLevel         @default(MEDIUM)
  investigationMethod CAPAInvestigationMethod?
  type                CAPAType
  title               String
  description         String
  rootCause           String?
  correctiveAction    String?
  preventiveAction    String?
  status              CAPAStatus            @default(OPEN)
  priority            CAPAPriority          @default(MEDIUM)
  assignedToId        String?
  dueDate             DateTime?
  implementedAt       DateTime?
  verifiedAt          DateTime?
  verifiedById        String?
  effectiveness       String?
  closureDate         DateTime?
  closedAt            DateTime?
  closedById          String?
  notes               String?
  localData           Json?                 // Country-specific compliance data (UNBS, KEBS, etc.)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  assignedTo          User?                 @relation("CAPAAssignedTo", fields: [assignedToId], references: [id])
  closedBy            User?                 @relation("CAPAClosedBy", fields: [closedById], references: [id])
  ncr                 NonConformanceReport? @relation(fields: [ncrId], references: [id])
  organization        Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  verifiedBy          User?                 @relation("CAPAVerifiedBy", fields: [verifiedById], references: [id])
  tasks               CapaTask[]

  @@unique([organizationId, capaNumber])
  @@index([organizationId, status])
  @@index([type])
  @@index([source])
  @@index([riskLevel])
}

model CapaTask {
  id          String           @id @default(cuid())
  organizationId String
  capaId      String
  taskNumber  String
  title       String
  description String?
  assignedToId String?
  dueDate     DateTime?
  status      CapaTaskStatus   @default(OPEN)
  priority    CAPAPriority     @default(MEDIUM)
  completedAt DateTime?
  completedById String?
  notes       String?
  localData   Json?            // Country-specific task data
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  capa        CAPA             @relation(fields: [capaId], references: [id], onDelete: Cascade)
  assignedTo  User?            @relation("CapaTaskAssignedTo", fields: [assignedToId], references: [id])
  completedBy User?            @relation("CapaTaskCompletedBy", fields: [completedById], references: [id])
  organization Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, capaId, taskNumber])
  @@index([organizationId, status])
  @@index([capaId])
}

model TaxJurisdiction {
  id                   String           @id @default(cuid())
  organizationId       String
  code                 String
  name                 String
  country              String
  countryCode          String?          // ISO country code (UG, KE, TZ, etc.)
  stateProvince        String?
  countyDistrict       String?
  city                 String?
  postalCode           String?
  postalCodeStart      String?
  postalCodeEnd        String?
  jurisdictionType     JurisdictionType
  taxAuthority         String?
  taxLiabilityAccountId String?         // GL account for tax liability
  eInvoiceFormat       String?          // EFRIS, eTIMS, etc.
  requiresEInvoicing   Boolean          @default(false)
  metadata             Json?            // Store EFRIS/eTIMS config, API keys, etc.
  isActive             Boolean          @default(true)
  notes                String?
  parentJurisdictionId String?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  invoiceTaxLines      InvoiceTaxLine[]
  organization         Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  taxRules             TaxRule[]
  parentJurisdiction   TaxJurisdiction? @relation("JurisdictionHierarchy", fields: [parentJurisdictionId], references: [id])
  childJurisdictions   TaxJurisdiction[] @relation("JurisdictionHierarchy")
  taxLiabilityAccount  ChartOfAccount?  @relation(fields: [taxLiabilityAccountId], references: [id])

  @@unique([organizationId, code])
  @@index([organizationId, country])
  @@index([postalCode])
  @@index([taxLiabilityAccountId])
}

model TaxRule {
  id                 String           @id @default(cuid())
  organizationId     String
  name               String
  jurisdictionId     String?
  taxType            TaxRuleType      // Changed from String to enum
  taxRate            Decimal          @db.Decimal(5, 2)
  ruleType           TaxRuleType      // New: EXEMPTION, REVERSE_CHARGE, etc.
  applicableOn       String           // SALES, PURCHASES, BOTH
  productCategory    String?
  customerType       String?          // New: Individual, Business, etc.
  minimumAmount      Decimal?         @db.Decimal(19, 4)
  maximumAmount      Decimal?         @db.Decimal(19, 4)
  effectiveFrom      DateTime
  effectiveTo        DateTime?
  isCompound         Boolean          @default(false)
  compoundSequence   Int?             // Order in compound rules
  parentRuleId       String?          // For compound rule relationships
  calculationFormula String?
  priority           Int              @default(1) // New: Priority for rule evaluation
  isActive           Boolean          @default(true)
  notes              String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  invoiceTaxLines    InvoiceTaxLine[]
  exemptions         TaxExemption[]
  jurisdiction       TaxJurisdiction? @relation(fields: [jurisdictionId], references: [id])
  organization       Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parentRule         TaxRule?         @relation("CompoundRules", fields: [parentRuleId], references: [id])
  childRules         TaxRule[]        @relation("CompoundRules")

  @@index([organizationId, taxType])
  @@index([effectiveFrom, effectiveTo])
  @@index([ruleType, priority])
}

model TaxExemption {
  id                String       @id @default(cuid())
  organizationId    String
  exemptionNumber   String
  taxRuleId         String
  entityType        String
  entityId          String
  exemptionType     String
  exemptionRate     Decimal?     @db.Decimal(5, 2)
  certificateNumber String?
  issuingAuthority  String?      // New: URA, IRS, etc.
  issuedDate        DateTime?    // New: When certificate was issued
  validFrom         DateTime
  validTo           DateTime?    // Made optional
  documentUrl       String?      // New: URL to uploaded PDF certificate
  documentPath      String?      // New: File system path
  efrisReason       String?      // New: EFRIS exemption reason code
  reason            String?      // Human readable reason
  isActive          Boolean      @default(true)
  notes             String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  taxRule           TaxRule      @relation(fields: [taxRuleId], references: [id])

  @@unique([organizationId, exemptionNumber])
  @@index([entityType, entityId])
  @@index([validFrom, validTo])
  @@index([issuingAuthority])
  @@index([exemptionType])
}

model LocalizationConfig {
  id                    String       @id @default(cuid())
  organizationId        String       @unique
  country               String
  language              String       @default("en")
  dateFormat            String       @default("MM/DD/YYYY")
  timeFormat            String       @default("12h")
  numberFormat          String       @default("1,234.56")
  currencyFormat        String       @default("$1,234.56")
  firstDayOfWeek        Int          @default(0)
  fiscalYearStart       Int          @default(1)
  taxIdLabel            String?
  addressFormat         Json?
  reportingRequirements Json?
  complianceSettings    Json?
  customFields          Json?

  // Enhanced localization metadata for global design with localized configuration
  apiEndpoints          Json?        // API endpoints for tax authorities (EFRIS, URA, HMRC, etc.)
  taxReturnTemplates    Json?        // Tax return form templates and requirements
  digitalFiscalization  Json?        // Digital fiscalization settings (e-invoicing, QR codes, etc.)
  translationKeys       Json?        // Translation keys for tax labels and messages
  complianceDrivers     Json?        // Country-specific compliance driver configurations
  fiscalCalendar        Json?        // Fiscal year and tax period configurations
  regulatoryBodies      Json?        // Tax authority contact info and requirements

  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
  organization          Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
}

model AssemblyTransaction {
  id                     String           @id @default(cuid())
  organizationId         String
  branchId               String?
  bomId                  String
  finishedProductId      String
  assemblyNumber         String           @unique
  assemblyDate           DateTime         @default(now())
  quantity               Decimal          @db.Decimal(12, 4)
  materialCost           Decimal          @db.Decimal(19, 4)
  laborCost              Decimal          @db.Decimal(19, 4)
  overheadCost           Decimal          @db.Decimal(19, 4)
  wastageQuantity        Decimal          @default(0) @db.Decimal(12, 4)
  wastageCost            Decimal          @default(0) @db.Decimal(19, 4)
  totalManufacturingCost Decimal          @db.Decimal(19, 4)
  previousUnitCost       Decimal          @db.Decimal(19, 4)
  newUnitCost            Decimal          @db.Decimal(19, 4)
  isExcisableProduct     Boolean          @default(false)
  exciseDutyRate         Decimal          @default(0) @db.Decimal(5, 2)
  exciseDutyAmount       Decimal          @default(0) @db.Decimal(19, 4)
  inputVATRecovered      Decimal          @default(0) @db.Decimal(19, 4)
  glTransactionId        String?
  rawMaterialAccountId   String?
  finishedGoodsAccountId String?
  laborAccountId         String?
  overheadAccountId      String?
  status                 AssemblyStatus   @default(DRAFT)
  approvedBy             String?
  approvedAt             DateTime?
  notes                  String?
  attachments            String[]
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  lines                  AssemblyLine[]
  bom                    BillOfMaterial   @relation(fields: [bomId], references: [id])
  branch                 Branch?          @relation(fields: [branchId], references: [id])
  finishedProduct        Product          @relation(fields: [finishedProductId], references: [id])
  organization           Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  exciseDutyRecord       UGExcisableDuty?
  wasteTracking          WastageTracking?

  @@unique([organizationId, assemblyNumber])
  @@index([organizationId, assemblyDate])
  @@index([bomId])
  @@index([status])
  @@index([glTransactionId])
}

model AssemblyLine {
  id                    String              @id @default(cuid())
  assemblyTransactionId String
  componentProductId    String
  plannedQuantity       Decimal             @db.Decimal(12, 4)
  actualQuantity        Decimal             @db.Decimal(12, 4)
  wasteQuantity         Decimal             @default(0) @db.Decimal(12, 4)
  unitCost              Decimal             @db.Decimal(19, 4)
  plannedCost           Decimal             @db.Decimal(19, 4)
  actualCost            Decimal             @db.Decimal(19, 4)
  wasteCost             Decimal             @default(0) @db.Decimal(19, 4)
  costVariance          Decimal             @default(0) @db.Decimal(19, 4)
  lotId                 String?
  warehouseId           String?
  notes                 String?
  createdAt             DateTime            @default(now())
  assemblyTransaction   AssemblyTransaction @relation(fields: [assemblyTransactionId], references: [id], onDelete: Cascade)
  componentProduct      Product             @relation(fields: [componentProductId], references: [id])
  lot                   InventoryLot?       @relation(fields: [lotId], references: [id])
  warehouse             InventoryWarehouse? @relation(fields: [warehouseId], references: [id])

  @@index([assemblyTransactionId])
  @@index([componentProductId])
  @@index([lotId])
}

model WastageTracking {
  id                    String              @id @default(cuid())
  assemblyTransactionId String              @unique
  totalWastageQuantity  Decimal             @db.Decimal(12, 4)
  totalWastageCost      Decimal             @db.Decimal(19, 4)
  wastagePercentage     Decimal             @db.Decimal(6, 2)
  wastageReasons        String[]
  description           String?
  scrapValue            Decimal             @default(0) @db.Decimal(19, 4)
  scrapAccountId        String?
  documentationUrl      String?
  authorizedBy          String?
  authorizedAt          DateTime?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  assemblyTransaction   AssemblyTransaction @relation(fields: [assemblyTransactionId], references: [id], onDelete: Cascade)

  @@index([assemblyTransactionId])
}

model UGExcisableDuty {
  id                    String               @id @default(cuid())
  assemblyTransactionId String               @unique
  productSKU            String
  productName           String
  excisableCategoryId   String
  baseValue             Decimal              @db.Decimal(19, 4)
  exciseRate            Decimal              @db.Decimal(5, 2)
  exciseDutyAmount      Decimal              @db.Decimal(19, 4)
  inputVATOnMaterials   Decimal              @db.Decimal(19, 4)
  outputVATOnFinished   Decimal              @db.Decimal(19, 4)
  netVATPosition        Decimal              @db.Decimal(19, 4)
  efrisReportingStatus  EFRISReportingStatus @default(PENDING)
  efrisTransmissionNo   String?
  efrisReportedAt       DateTime?
  whtApplies            Boolean              @default(false)
  whtRate               Decimal              @default(0) @db.Decimal(5, 2)
  whtAmount             Decimal              @default(0) @db.Decimal(19, 4)
  exciseDutyAccountId   String?
  notes                 String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  assemblyTransaction   AssemblyTransaction  @relation(fields: [assemblyTransactionId], references: [id], onDelete: Cascade)

  @@index([assemblyTransactionId])
  @@index([efrisReportingStatus])
}

model ManufacturingLaborCost {
  id             String        @id @default(cuid())
  organizationId String
  name           String
  costType       LaborCostType
  rate           Decimal       @db.Decimal(12, 4)
  laborAccountId String?
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organization   Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model ManufacturingOverhead {
  id                String                   @id @default(cuid())
  organizationId    String
  name              String
  description       String?
  allocationMethod  OverheadAllocationMethod
  rate              Decimal                  @db.Decimal(12, 4)
  overheadAccountId String?
  isActive          Boolean                  @default(true)
  effectiveFrom     DateTime                 @default(now())
  effectiveTo       DateTime?
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt
  organization      Organization             @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([allocationMethod])
}

model EFRISExcisableList {
  id             String       @id @default(cuid())
  organizationId String
  categoryCode   String
  categoryName   String
  description    String?
  exciseRate     Decimal      @db.Decimal(5, 2)
  lastSyncedAt   DateTime?
  effectiveFrom  DateTime
  effectiveTo    DateTime?
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, categoryCode])
  @@index([organizationId, isActive])
}

enum PackageTier {
  PROFESSIONAL
  ADVANCED
}

enum BranchType {
  HEADQUARTERS
  OFFICE
  WAREHOUSE
  RETAIL_STORE
  MANUFACTURING
  DISTRIBUTION_CENTER
  SERVICE_CENTER
  REMOTE
}

enum DocumentType {
  INVOICE
  BILL
  CREDIT_NOTE
  DEBIT_NOTE
  PAYMENT
  CUSTOMER
  VENDOR
  TRANSACTION
}

enum IntegrationType {
  PAYMENT_GATEWAY
  BANKING
  ACCOUNTING
  E_COMMERCE
  CRM
  INVENTORY
  PAYROLL
  TAX_FILING
  REPORTING
  CUSTOM_API
  WEBHOOK
  E_INVOICING
  TAX_ENGINE
  SHIPPING_CARRIER
  POS
  CPQ
  PLM
}

enum IntegrationStatus {
  ACTIVE
  INACTIVE
  ERROR
  PENDING
  SUSPENDED
}

enum UserRole {
  ADMIN
  ACCOUNTANT
  MANAGER
  VIEWER
}
// RBAC permission scopes across app sections
enum PermissionSection {
  GENERAL_LEDGER
  INVOICES
  REPORTS
  PAYMENTS
  VENDORS
  CUSTOMERS
}

// Granular permission actions
enum PermissionAction {
  VIEW
  EDIT
  DELETE
  APPROVE
}

// Invitation lifecycle for org onboarding
enum InviteStatus {
  PENDING
  ACCEPTED
  EXPIRED
  REVOKED
}

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
  COST_OF_SALES
}

enum TransactionType {
  JOURNAL_ENTRY
  INVOICE
  BILL
  PAYMENT
  RECEIPT
  BANK_TRANSFER
  INVENTORY_ADJUSTMENT
  DEPRECIATION
  OPENING_BALANCE
  CLOSING_ENTRY
}

enum TransactionStatus {
  DRAFT
  POSTED
  VOIDED
  CANCELLED
}

enum EntryType {
  DEBIT
  CREDIT
}

enum InvoiceStatus {
  DRAFT
  SENT
  VIEWED
  PARTIALLY_PAID
  PAID
  OVERDUE
  CANCELLED
  VOIDED
}

enum POStatus {
  DRAFT
  SENT
  CONFIRMED
  PARTIALLY_RECEIVED
  RECEIVED
  CLOSED
  CANCELLED
}

enum BillStatus {
  DRAFT
  SUBMITTED
  APPROVED
  PARTIALLY_PAID
  PAID
  OVERDUE
  CANCELLED
  VOIDED
}

enum PaymentType {
  RECEIPT
  PAYMENT
  INTERNAL_TRANSFER
}

enum PaymentMethod {
  CASH
  CHECK
  BANK_TRANSFER
  CREDIT_CARD
  DEBIT_CARD
  ONLINE_PAYMENT
  OTHER
}

enum BankAccountType {
  CHECKING
  SAVINGS
  CREDIT_CARD
  LINE_OF_CREDIT
  MONEY_MARKET
}

enum ReconciliationStatus {
  IN_PROGRESS
  COMPLETED
  REVIEWED
}

enum RecurringTemplateType {
  JOURNAL_ENTRY
  INVOICE
  BILL
  PAYMENT
}

enum RecurringFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
  CUSTOM_CRON
}

enum RecurringStatus {
  ACTIVE
  PAUSED
  ARCHIVED
}

enum ExecutionStatus {
  PENDING
  SUCCESS
  FAILED
  SKIPPED
}

enum ProductType {
  INVENTORY
  SERVICE
  NON_INVENTORY
}

enum MovementType {
  PURCHASE
  SALE
  ADJUSTMENT
  TRANSFER
  RETURN
  WRITE_OFF
}

enum WarehouseType {
  GENERAL
  MANUFACTURING
  RECEIVING
  SHIPPING
  QA_HOLD
  THIRD_PARTY
}

enum BinType {
  STANDARD
  REPLENISHMENT
  PICKING
  BULK
  RECEIVING
  SHIPPING
  HOLD
}

enum LotStatus {
  ACTIVE
  QUARANTINE
  EXPIRED
  CONSUMED
  SCRAPPED
}

enum SerialStatus {
  AVAILABLE
  ALLOCATED
  IN_PROGRESS
  CONSUMED
  SCRAPPED
}

enum TransferOrderStatus {
  DRAFT
  REQUESTED
  PICKING
  IN_TRANSIT
  RECEIVED
  CANCELLED
}

enum BomStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum RoutingStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum WorkOrderStatus {
  PLANNED
  RELEASED
  IN_PROGRESS
  HOLD
  COMPLETED
  CLOSED
  CANCELLED
}

enum WorkOrderOperationStatus {
  PENDING
  IN_PROGRESS
  DONE
  SKIPPED
}

enum PeriodStatus {
  OPEN
  CLOSED
  LOCKED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  APPROVE
  VOID
  RECONCILE
  LOGIN
  LOGOUT
  EXPORT
}

enum TaxType {
  VAT
  GST
  SALES_TAX
  EXCISE
  IMPORT_DUTY
  WITHHOLDING
  PAYROLL
}

enum TaxRuleType {
  STANDARD_RATE
  REDUCED_RATE
  ZERO_RATE
  EXEMPTION
  REVERSE_CHARGE
  COMPOUND
  WITHHOLDING
  CUSTOM
}

enum WHTType {
  PROFESSIONAL_SERVICES
  MANAGEMENT_FEES
  RENT
  DIVIDENDS
  INTEREST
  ROYALTIES
  COMMISSION
  CONTRACTORS
  IMPORTED_SERVICES
}

enum TaxReturnType {
  VAT_MONTHLY
  VAT_QUARTERLY
  INCOME_TAX_PROVISIONAL
  INCOME_TAX_ANNUAL
  WHT_MONTHLY
  PAYE_MONTHLY
  CIT_ANNUAL
}

enum TaxReturnStatus {
  DRAFT
  READY_TO_FILE
  FILED
  PAID
  OVERDUE
  AMENDED
}

enum DepreciationMethod {
  STRAIGHT_LINE
  DECLINING_BALANCE
  DOUBLE_DECLINING
  SUM_OF_YEARS
  UNITS_OF_PRODUCTION
}

enum AssetStatus {
  ACTIVE
  INACTIVE
  UNDER_MAINTENANCE
  DISPOSED
  LOST
  WRITTEN_OFF
}

enum DisposalMethod {
  SALE
  TRADE_IN
  SCRAP
  DONATION
  LOST
  WRITE_OFF
}

enum MaintenanceType {
  ROUTINE
  REPAIR
  INSPECTION
  UPGRADE
  EMERGENCY
  PREVENTIVE
  PREDICTIVE
  CORRECTIVE
}

enum MaintenanceStatus {
  SCHEDULED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
  OVERDUE
}

enum CreditNoteReason {
  GOODS_RETURNED
  DAMAGED_GOODS
  PRICING_ERROR
  BILLING_ERROR
  DISCOUNT_ADJUSTMENT
  SERVICE_ISSUE
  CANCELLATION
  GOODWILL
  OTHER
}

enum CreditNoteStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  APPLIED
  PARTIALLY_APPLIED
  VOID
}

enum DebitNoteReason {
  ADDITIONAL_CHARGES
  LATE_PAYMENT_FEE
  INTEREST_CHARGE
  SHIPPING_ADJUSTMENT
  PRICE_ADJUSTMENT
  SERVICE_UPGRADE
  UNDERBILLING
  PENALTY
  OTHER
}

enum DebitNoteStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  PARTIALLY_PAID
  PAID
  VOID
  OVERDUE
}

enum EmployeeStatus {
  ACTIVE
  ON_LEAVE
  SUSPENDED
  TERMINATED
  RETIRED
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  TEMPORARY
  INTERN
}

enum PayFrequency {
  WEEKLY
  BI_WEEKLY
  SEMI_MONTHLY
  MONTHLY
  QUARTERLY
  ANNUALLY
}

enum PositionStatus {
  OPEN
  FILLED
  CLOSED
  ON_HOLD
}

enum PayrollStatus {
  DRAFT
  CALCULATED
  APPROVED
  PAID
  CANCELLED
}

enum BenefitType {
  HEALTH_INSURANCE
  DENTAL_INSURANCE
  VISION_INSURANCE
  LIFE_INSURANCE
  RETIREMENT_401K
  PENSION
  STOCK_OPTIONS
  OTHER
}

enum EnrollmentStatus {
  PENDING
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum TimeEntryStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
}

enum ExpenseClaimStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  PAID
}

enum ReviewStatus {
  DRAFT
  IN_PROGRESS
  COMPLETED
  APPROVED
}

enum ServicePriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ServiceOrderStatus {
  SCHEDULED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum ServiceType {
  PROFESSIONAL      // Consulting, advisory, design
  TECHNICAL         // Installation, repair, maintenance
  CREATIVE          // Design, content creation, marketing
  EDUCATIONAL       // Training, workshops, certification
  SUPPORT           // Help desk, customer support, documentation
  ADMINISTRATIVE    // Data entry, bookkeeping, compliance
  FIELD_SERVICE     // On-site service, delivery, inspection
  DIGITAL           // Software development, digital marketing, automation
  RESEARCH          // Market research, analysis, audit
  PROJECT_BASED     // Full project delivery with milestones
}

enum ServicePricingModel {
  FIXED_PRICE       // One-time fixed cost
  HOURLY_RATE       // Per hour billing
  DAILY_RATE        // Per day billing
  PROJECT_BASED     // Fixed price for entire project
  VALUE_BASED       // Based on value delivered
  RETAINER          // Monthly retainer fee
  SUBSCRIPTION      // Recurring subscription
  PER_USER          // Price per user/license
  PER_TRANSACTION   // Price per transaction/usage
  TIERED            // Different tiers with different pricing
}

enum ServiceSkillLevel {
  ENTRY_LEVEL
  JUNIOR
  STANDARD
  SENIOR
  EXPERT
  SPECIALIST
}

enum ServiceLocation {
  CLIENT_SITE       // At customer location
  OUR_OFFICE        // At service provider location
  REMOTE            // Online/virtual delivery
  HYBRID            // Combination of remote and on-site
  FIELD             // Mobile/traveling service
  WORKSHOP          // In dedicated training/workshop space
}

enum ServiceDeliveryMethod {
  ON_SITE           // Physical presence required
  REMOTE            // Fully remote delivery
  VIRTUAL           // Online meetings/sessions
  SELF_PACED        // Customer completes at own pace
  BLENDED           // Mix of delivery methods
  WORKSHOP          // Group workshop format
  ONE_ON_ONE        // Individual coaching/consulting
}

enum ServiceDeliveryStatus {
  PLANNED
  SCHEDULED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
  RESCHEDULED
  PENDING_APPROVAL
}

enum ServiceBookingStatus {
  REQUESTED
  PENDING_APPROVAL
  CONFIRMED
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
  RESCHEDULED
}

enum ActivityStatus {
  NOT_STARTED
  IN_PROGRESS
  BLOCKED
  COMPLETED
  CANCELLED
  ON_HOLD
}

enum ServiceWorkType {
  DELIVERY          // Core service delivery
  PREPARATION       // Pre-work, setup, research
  TRAVEL            // Travel time to/from client
  ADMIN             // Administrative work
  FOLLOW_UP         // Post-delivery support
  QUALITY_ASSURANCE // QA and review activities
  CLIENT_COMMUNICATION // Meetings, calls, emails
}

enum ServiceResourceType {
  HUMAN             // People/staff
  EQUIPMENT         // Tools, machinery, vehicles
  FACILITY          // Rooms, spaces, venues
  DIGITAL           // Software licenses, platforms
  MATERIAL          // Consumable materials
}

enum ResourceAvailability {
  AVAILABLE
  BUSY
  PARTIALLY_AVAILABLE
  UNAVAILABLE
  ON_LEAVE
  OVERBOOKED
}

enum PaymentStatus {
  UNPAID
  PARTIALLY_PAID
  PAID
  OVERDUE
  REFUNDED
  DISPUTED
}

enum ReportType {
  BALANCE_SHEET
  PROFIT_LOSS
  CASH_FLOW
  TRIAL_BALANCE
  AGED_RECEIVABLES
  AGED_PAYABLES
  INVENTORY_VALUATION
  SALES_ANALYSIS
  PURCHASE_ANALYSIS
  CUSTOM
}

enum ScheduleFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
  CUSTOM
}

enum ReportFormat {
  PDF
  EXCEL
  CSV
  JSON
}

enum ScheduleExecutionStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
}

enum ApprovalEntityType {
  PURCHASE_ORDER
  BILL
  PAYMENT
  JOURNAL
  EXPENSE_CLAIM
  CREDIT_NOTE
  DEBIT_NOTE
  TRANSFER
  INVOICE
}

enum ApproverType {
  USER
  ROLE
  MANAGER
  CUSTOM
}

enum ApprovalStatus {
  PENDING
  IN_PROGRESS
  APPROVED
  REJECTED
  CANCELLED
}

enum ApprovalPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum ApprovalActionType {
  APPROVE
  REJECT
  DELEGATE
  COMMENT
}

enum EventStatus {
  SUCCESS
  FAILED
  PENDING
}

enum MFAMethod {
  TOTP
  SMS
  EMAIL
}

enum MasterDataStatus {
  DRAFT
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

enum PromotionType {
  BUY_X_GET_Y
  BUNDLE
  TIERED
  FREE_SHIPPING
}

enum CycleCountStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ValuationMethod {
  FIFO
  LIFO
  WEIGHTED_AVERAGE
  STANDARD
}

enum ReservationStatus {
  ACTIVE
  FULFILLED
  EXPIRED
  CANCELLED
}

enum CostingMethod {
  STANDARD
  FIFO
  LIFO
  WEIGHTED_AVERAGE
  SPECIFIC_IDENTIFICATION
}

enum StandardCostStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  FROZEN
  REJECTED
  EXPIRED
  SUPERSEDED
}

enum VarianceType {
  MATERIAL_PRICE
  MATERIAL_USAGE
  LABOR_RATE
  LABOR_EFFICIENCY
  OVERHEAD_SPENDING
  OVERHEAD_VOLUME
  PURCHASE_PRICE
  PRODUCTION
}

enum LandedCostAllocation {
  BY_VALUE
  BY_WEIGHT
  BY_VOLUME
  BY_QUANTITY
  MANUAL
}

enum RevaluationStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  POSTED
  CANCELLED
}

enum ForecastMethod {
  MOVING_AVERAGE
  EXPONENTIAL_SMOOTHING
  LINEAR_REGRESSION
  SEASONAL
  MACHINE_LEARNING
  MANUAL
}

enum SafetyStockMethod {
  FIXED
  PERCENTAGE_OF_DEMAND
  BASED_ON_LEAD_TIME
  STATISTICAL
}

enum ReorderPolicyType {
  MIN_MAX
  REORDER_POINT
  PERIODIC_REVIEW
  ECONOMIC_ORDER_QUANTITY
  JUST_IN_TIME
}

enum PlanningMethod {
  MRP
  MRP_II
  KANBAN
  LEAN
  MANUAL
}

enum ABCClass {
  A
  B
  C
}

enum CriticalityLevel {
  LOW
  NORMAL
  HIGH
  CRITICAL
}

enum InspectionType {
  RECEIVING
  IN_PROCESS
  FINAL
  OUTGOING
  AUDIT
}

enum InspectionStatus {
  PENDING
  IN_PROGRESS
  PASSED
  FAILED
  CONDITIONAL
  CANCELLED
}

enum InspectionPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum HoldType {
  QUALITY
  SAFETY
  REGULATORY
  SUPPLIER_RECALL
  CUSTOMER_COMPLAINT
  INTERNAL_REVIEW
}

enum HoldStatus {
  ACTIVE
  RELEASED
  SCRAPPED
  REWORKED
  RETURNED
}

enum DispositionAction {
  USE_AS_IS
  REWORK
  SCRAP
  RETURN_TO_VENDOR
  SORT
}

enum NCRSource {
  RECEIVING_INSPECTION
  IN_PROCESS
  FINAL_INSPECTION
  CUSTOMER_COMPLAINT
  VENDOR_ISSUE
  INTERNAL_AUDIT
  EXTERNAL_AUDIT
}

enum NCRSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum NCRStatus {
  OPEN
  INVESTIGATING
  CONTAINMENT
  ROOT_CAUSE_ANALYSIS
  CORRECTIVE_ACTION
  VERIFICATION
  CLOSED
  CANCELLED
}

enum CAPAType {
  CORRECTIVE
  PREVENTIVE
  BOTH
}

enum CAPAStatus {
  OPEN
  IN_PROGRESS
  IMPLEMENTED
  VERIFYING
  VERIFIED
  CLOSED
  CANCELLED
}

enum CAPAPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum CAPASource {
  NCR
  AUDIT
  CUSTOMER_COMPLAINT
  MANAGEMENT_REVIEW
  INTERNAL_REVIEW
  SUPPLIER_ISSUE
  OTHER
}

enum CAPARiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum CAPAInvestigationMethod {
  FIVE_WHY
  FISHBONE
  PARETO
  FMEA
  OTHER
}

enum CapaTaskStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum JurisdictionType {
  FEDERAL
  STATE
  COUNTY
  CITY
  LOCAL
  SPECIAL
}

enum AssemblyStatus {
  DRAFT
  READY_FOR_REVIEW
  APPROVED
  POSTED
  REVERSED
}

enum EFRISReportingStatus {
  PENDING
  TRANSMITTED
  ACCEPTED
  REJECTED
  AMENDED
}

enum LaborCostType {
  HOURLY_RATE
  FLAT_COST
  PER_UNIT
}

enum OverheadAllocationMethod {
  PERCENTAGE
  FIXED
  MATERIAL_PERCENTAGE
  LABOR_PERCENTAGE
  PER_UNIT
}

// ============================================
// LANDING PAGE & SYSTEM SETTINGS
// ============================================

model SystemSettings {
  id                String   @id @default(cuid())
  // Company Information
  companyName       String   @default("YourBooks ERP")
  companyTagline    String   @default("Professional Accounting Made Simple")
  companyDescription String?
  companyEmail      String?
  companyPhone      String?
  supportEmail      String?
  // Hero Section
  heroTitle         String   @default("Complete ERP Solution for Modern Businesses")
  heroSubtitle      String   @default("Enterprise-grade accounting system with double-entry bookkeeping, multi-tenant architecture, and real-time financial reporting.")
  heroCTA1Text      String   @default("Access Dashboard")
  heroCTA1Link      String   @default("/login")
  heroCTA2Text      String   @default("Watch Demo")
  heroCTA2Link      String   @default("/login")
  // Features
  showModules       Boolean  @default(true)
  showStats         Boolean  @default(true)
  showDemoCredentials Boolean @default(true)
  // Contact Info
  address           String?
  city              String?
  state             String?
  zipCode           String?
  country           String?
  // Branding
  logo              String?
  favicon           String?
  primaryColor      String   @default("#2563eb")
  secondaryColor    String   @default("#4f46e5")
  // Meta
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  socialMediaLinks  SocialMediaLink[]
  pricingPlans      PricingPlan[]
  featureHighlights FeatureHighlight[]
  testimonials      Testimonial[]
}

model SocialMediaLink {
  id              String          @id @default(cuid())
  platform        String          // "github", "twitter", "linkedin", "facebook", "instagram", etc.
  url             String
  icon            String?         // Optional custom icon path
  displayOrder    Int             @default(0)
  isActive        Boolean         @default(true)
  systemSettingsId String
  systemSettings  SystemSettings  @relation(fields: [systemSettingsId], references: [id], onDelete: Cascade)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([systemSettingsId])
}

model PricingPlan {
  id              String          @id @default(cuid())
  name            String          // "Starter", "Professional", "Enterprise"
  description     String?
  price           Decimal         @db.Decimal(10, 2)
  currency        String          @default("USD")
  billingPeriod   String          @default("MONTHLY") // "MONTHLY", "YEARLY"
  features        String[]        // Array of feature descriptions
  isPopular       Boolean         @default(false)
  displayOrder    Int             @default(0)
  isActive        Boolean         @default(true)
  ctaText         String          @default("Get Started")
  ctaLink         String          @default("/register")
  systemSettingsId String
  systemSettings  SystemSettings  @relation(fields: [systemSettingsId], references: [id], onDelete: Cascade)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([systemSettingsId])
}

model FeatureHighlight {
  id              String          @id @default(cuid())
  title           String
  description     String
  icon            String?         // Icon name or path
  color           String          @default("blue") // Color theme
  link            String?         // Optional link for "Learn more"
  displayOrder    Int             @default(0)
  isActive        Boolean         @default(true)
  systemSettingsId String
  systemSettings  SystemSettings  @relation(fields: [systemSettingsId], references: [id], onDelete: Cascade)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([systemSettingsId])
}

model Testimonial {
  id              String          @id @default(cuid())
  customerName    String
  customerRole    String?
  companyName     String?
  content         String
  rating          Int?            @default(5)
  avatar          String?
  displayOrder    Int             @default(0)
  isActive        Boolean         @default(true)
  systemSettingsId String
  systemSettings  SystemSettings  @relation(fields: [systemSettingsId], references: [id], onDelete: Cascade)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([systemSettingsId])
}
